#textdomain wesnoth-loi
[scenario]
	id="35b_Flooded_Tunnels"
	name= _ "Flooded Tunnels"
	map_data="{~add-ons/Legends_of_Idaamub/maps/35b_Flooded_Tunnels.map}"
	victory_when_enemies_defeated=no
	# next_scenario=29_Black_Forest

	{UNDERGROUND}

	{PLACE_IMAGE units/human-loyalists/duelist-die8.png 38 8}
	{PLACE_IMAGE units/human-loyalists/knight-se-die5.png 37 11}
	{PLACE_IMAGE units/human-loyalists/pikeman-die5.png 37 9}
	{PLACE_IMAGE scenery/wall-switch-up.png 54 7}
	[item]
		x,y=69,7
		halo="scenery/engine.png"
	[/item]

	{BASIC_CHEST 53 18 (bow, mace, staff, axe)}	
	{BASIC_CHEST 55 18 (bow, mace, staff, axe)}

	[event]
		name=prestart
		
		[set_variable]
			name=scenario_number
			value=35
		[/set_variable]

		{VARIABLE hunters_found 0}
		{VARIABLE lever1 0}
		{VARIABLE lever2 0}
		{VARIABLE wheel_east 0}
		{VARIABLE wheel_north 0}
		{VARIABLE wheel_west 0}
		{VARIABLE wheel_south 0}

		[objectives]
			side=1
			[objective]
				[show_if]
					[variable]
						name=quest_Oboavlidlu
						equals=0
					[/variable]
				[/show_if]
				description= _ "Explore the tunnels"
				condition=win
			[/objective]
			[objective]
				[show_if]
					[variable]
						name=quest_Oboavlidlu
						equals=1
					[/variable]
					[variable]
						name=hunters_found
						equals=0
					[/variable]
				[/show_if]
				description= _ "Find the treasure hunters"
				condition=win
			[/objective]
			[objective]
				[show_if]
					[variable]
						name=quest_Oboavlidlu
						equals=1
					[/variable]
					[variable]
						name=hunters_found
						equals=1
					[/variable]
				[/show_if]
				description= _ "Report back to Oboavlidlu"
				condition=win
			[/objective]
			{FOOD_OBJECTIVES}
			[objective]
				description= _ "Death of Io"
				condition=lose
			[/objective]
			{TURNS_RUN_OUT}

			[gold_carryover]
				bonus=yes
				carryover_percentage=100
			[/gold_carryover]
		[/objectives]

		[if]
			[variable]
				name=entrance
				equals=1
			[/variable]
			[then]
				{LOI_RECALL_ALL 8 41}
			[/then]
			[else]
				[teleport]
					[filter]
						id=Io
					[/filter]
					x,y=29,48
					animate=no
				[/teleport]
				[place_shroud]
					x,y=8,41
					radius=2
				[/place_shroud]
				{LOI_RECALL_ALL 29 48}
			[/else]
		[/if]
	[/event]

	[side]
		type="Young Man"
		id=Io
		name= _ "Io"
		x=8
		y=41
		fog=no
		shroud=yes
		side=1
		canrecruit=yes
		profile=portraits/Io.png
		defeat_condition=no_units_left
		controller=human
		team_name=heroes
		user_team_name=_"Heroes"
	[/side]

	[side]
		fog=no
		shroud=no
		side=2
		team_name=saurians
		hidden=yes
		user_team_name="Matriarch"
		[unit]
			name=_"Refumee"
			type="Saurian Matriarch"
			x=24
			y=30
		[/unit]
	[/side]

	[side]
		no_leader=yes
		fog=no
		shroud=no
		side=3
		team_name=saurians
		user_team_name="Saurians"
		[unit]
			ai_special=guardian
			name=_"Jile"
			type="Saurian Flanker"
			x=29
			y=29
		[/unit]
		[unit]
			ai_special=guardian
			name=_"Xetraezz"
			type="Saurian Flanker"
			x=31
			y=29
		[/unit]
		[unit]
			ai_special=guardian
			name=_"Stoixizs"
			type="Saurian Flanker"
			x=26
			y=31
		[/unit]
		[unit]
			ai_special=guardian
			name=_"Liil"
			type="Saurian Flanker"
			x=28
			y=32
		[/unit]
		[unit]
			ai_special=guardian
			name=_"Ke’Uszizs"
			type="Saurian Flanker"
			x=29
			y=37
		[/unit]
		[unit]
			ai_special=guardian
			name=_"Pole"
			type="Saurian Javelineer"
			x=29
			y=39
		[/unit]
		[unit]
			ai_special=guardian
			name=_"Xi’Kzaaz"
			type="Saurian Javelineer"
			x=29
			y=40
		[/unit]
		[unit]
			ai_special=guardian
			name=_"Inezz"
			type="Saurian Javelineer"
			x=23
			y=35
		[/unit]
		[unit]
			ai_special=guardian
			name=_"Maexirr"
			type="Saurian Flanker"
			x=21
			y=36
		[/unit]
		[unit]
			ai_special=guardian
			type="Kraken"
			x=22
			y=34
		[/unit]
		[unit]
			ai_special=guardian
			type="Kraken"
			x=34
			y=35
		[/unit]
		[unit]
			ai_special=guardian
			name=_"Chale"
			type="Saurian Javelineer"
			x=34
			y=32
		[/unit]
		[unit]
			ai_special=guardian
			name=_"Keixezz"
			type="Saurian Javelineer"
			x=34
			y=33
		[/unit]
		[unit]
			ai_special=guardian
			name=_"Saesz"
			type="Saurian Flanker"
			x=37
			y=27
		[/unit]
		[unit]
			ai_special=guardian
			name=_"Vri’Uszez"
			type="Saurian Flanker"
			x=34
			y=27
		[/unit]
		[unit]
			ai_special=guardian
			name=_"Bzzix"
			type="Saurian Javelineer"
			x=34
			y=23
		[/unit]
		[unit]
			ai_special=guardian
			type="Kraken"
			x=37
			y=24
		[/unit]
		[unit]
			ai_special=guardian
			type="Kraken"
			x=34
			y=26
		[/unit]
		[unit]
			ai_special=guardian
			type="Kraken"
			x=34
			y=24
		[/unit]
		[unit]
			ai_special=guardian
			type="Kraken"
			x=39
			y=24
		[/unit]
		[unit]
			ai_special=guardian
			name=_"Naix"
			type="Saurian Flanker"
			x=42
			y=15
		[/unit]
		[unit]
			ai_special=guardian
			name=_"Zilixir"
			type="Saurian Flanker"
			x=42
			y=24
		[/unit]
		[unit]
			ai_special=guardian
			name=_"Amiss"
			type="Saurian Flanker"
			x=42
			y=19
		[/unit]
		[unit]
			ai_special=guardian
			name=_"Jezzirr"
			type="Saurian Flanker"
			x=42
			y=22
		[/unit]
		[unit]
			ai_special=guardian
			name=_"Seil"
			type="Saurian Javelineer"
			x=42
			y=23
		[/unit]
		[unit]
			ai_special=guardian
			name=_"Zilanirr"
			type="Saurian Javelineer"
			x=43
			y=16
		[/unit]
		[unit]
			ai_special=guardian
			name=_"Kata"
			type="Saurian Javelineer"
			x=42
			y=18
		[/unit]
		[unit]
			ai_special=guardian
			name=_"Jiexix"
			type="Saurian Javelineer"
			x=46
			y=22
		[/unit]
		[unit]
			ai_special=guardian
			name=_"Loez"
			type="Saurian Javelineer"
			x=45
			y=22
		[/unit]
		[unit]
			ai_special=guardian
			type="Shadow Jumping Spider"
			x=48
			y=23
		[/unit]
		[unit]
			ai_special=guardian
			type="Shadow Jumping Spider"
			x=48
			y=21
		[/unit]
		[unit]
			ai_special=guardian
			name=_"Innaesz"
			type="Saurian Flanker"
			x=46
			y=21
		[/unit]
		[unit]
			ai_special=guardian
			type="Kraken"
			x=45
			y=24
		[/unit]
		[unit]
			ai_special=guardian
			name=_"Fiir"
			type="Saurian Flanker"
			x=37
			y=14
		[/unit]
		[unit]
			ai_special=guardian
			name=_"Hazzile"
			type="Saurian Flanker"
			x=28
			y=16
		[/unit]
		[unit]
			ai_special=guardian
			name=_"Szaiss"
			type="Saurian Flanker"
			x=30
			y=15
		[/unit]
		[unit]
			ai_special=guardian
			name=_"Jiza"
			type="Saurian Javelineer"
			x=35
			y=14
		[/unit]
		[unit]
			ai_special=guardian
			name=_"Chassaix"
			type="Saurian Javelineer"
			x=31
			y=17
		[/unit]
		[unit]
			ai_special=guardian
			type="Shadow Jumping Spider"
			x=36
			y=18
		[/unit]
		[unit]
			ai_special=guardian
			type="Shadow Jumping Spider"
			x=38
			y=17
		[/unit]
		[unit]
			ai_special=guardian
			type="Shadow Jumping Spider"
			x=37
			y=17
		[/unit]
		[unit]
			ai_special=guardian
			type="Shadow Jumping Spider"
			x=37
			y=19
		[/unit]
		[unit]
			ai_special=guardian
			type="Shadow Jumping Spider"
			x=36
			y=19
		[/unit]
		[unit]
			ai_special=guardian
			type="Shadow Jumping Spider"
			x=38
			y=18
		[/unit]
		[unit]
			ai_special=guardian
			type="Shadow Jumping Spider"
			x=38
			y=19
		[/unit]
		[unit]
			ai_special=guardian
			type="Shadow Jumping Spider"
			x=37
			y=18
		[/unit]
		[unit]
			ai_special=guardian
			type="Shadow Jumping Spider"
			x=39
			y=19
		[/unit]
		[unit]
			ai_special=guardian
			type="Kraken"
			x=26
			y=13
		[/unit]
		[unit]
			ai_special=guardian
			type="Kraken"
			x=24
			y=12
		[/unit]
		[unit]
			ai_special=guardian
			type="Kraken"
			x=23
			y=17
		[/unit]
		[unit]
			ai_special=guardian
			type="Kraken"
			x=19
			y=15
		[/unit]
		[unit]
			ai_special=guardian
			type="Kraken"
			x=22
			y=15
		[/unit]
		[unit]
			ai_special=guardian
			type="Kraken"
			x=20
			y=16
		[/unit]
		[unit]
			ai_special=guardian
			type="Kraken"
			x=18
			y=11
		[/unit]
		[unit]
			ai_special=guardian
			type="Kraken"
			x=17
			y=14
		[/unit]
		[unit]
			ai_special=guardian
			type="Kraken"
			x=20
			y=15
		[/unit]
		[unit]
			ai_special=guardian
			type="Kraken"
			x=22
			y=14
		[/unit]
		[unit]
			ai_special=guardian
			type="Kraken"
			x=21
			y=16
		[/unit]
		[unit]
			ai_special=guardian
			type="Kraken"
			x=22
			y=16
		[/unit]
		[unit]
			ai_special=guardian
			type="Kraken"
			x=16
			y=13
		[/unit]
		[unit]
			ai_special=guardian
			type="Kraken"
			x=17
			y=12
		[/unit]
		[unit]
			ai_special=guardian
			name=_"Preirr"
			type="Saurian Javelineer"
			x=16
			y=14
		[/unit]
		[unit]
			ai_special=guardian
			name=_"Zanir"
			type="Saurian Javelineer"
			x=19
			y=18
		[/unit]
		[unit]
			ai_special=guardian
			name=_"Pre’Usztrax"
			type="Saurian Javelineer"
			x=17
			y=16
		[/unit]
		[unit]
			ai_special=guardian
			name=_"Amle"
			type="Saurian Flanker"
			x=20
			y=17
		[/unit]
		[unit]
			ai_special=guardian
			type="Kraken"
			x=14
			y=13
		[/unit]
		[unit]
			ai_special=guardian
			type="Kraken"
			x=6
			y=14
		[/unit]
		[unit]
			ai_special=guardian
			type="Kraken"
			x=10
			y=11
		[/unit]
		[unit]
			ai_special=guardian
			type="Kraken"
			x=6
			y=13
		[/unit]
		[unit]
			ai_special=guardian
			type="Kraken"
			x=5
			y=14
		[/unit]
		[unit]
			ai_special=guardian
			type="Kraken"
			x=4
			y=12
		[/unit]
		[unit]
			ai_special=guardian
			type="Kraken"
			x=13
			y=11
		[/unit]
		[unit]
			ai_special=guardian
			type="Kraken"
			x=8
			y=15
		[/unit]
		[unit]
			ai_special=guardian
			type="Kraken"
			x=13
			y=14
		[/unit]
		[unit]
			ai_special=guardian
			type="Kraken"
			x=4
			y=10
		[/unit]
		[unit]
			ai_special=guardian
			type="Kraken"
			x=9
			y=16
		[/unit]
		[unit]
			ai_special=guardian
			type="Kraken"
			x=9
			y=17
		[/unit]
		[unit]
			ai_special=guardian
			type="Kraken"
			x=14
			y=12
		[/unit]
		[unit]
			ai_special=guardian
			name=_"Ssitrais"
			type="Saurian Flanker"
			x=7
			y=20
		[/unit]
		[unit]
			ai_special=guardian
			name=_"Naza"
			type="Saurian Flanker"
			x=8
			y=22
		[/unit]
		[unit]
			ai_special=guardian
			name=_"Zzuixirr"
			type="Saurian Javelineer"
			x=8
			y=18
		[/unit]
		[unit]
			ai_special=guardian
			name=_"Sseazz"
			type="Saurian Javelineer"
			x=10
			y=26
		[/unit]
		[unit]
			ai_special=guardian
			name=_"Litraiss"
			type="Saurian Javelineer"
			x=7
			y=25
		[/unit]
		[unit]
			ai_special=guardian
			name=_"Inez"
			type="Saurian Flanker"
			x=10
			y=25
		[/unit]
		[unit]
			ai_special=guardian
			name=_"Liil"
			type="Saurian Flanker"
			x=8
			y=24
		[/unit]
		[unit]
			ai_special=guardian
			name=_"Po’Uszirr"
			type="Saurian Flanker"
			x=7
			y=24
		[/unit]
		[unit]
			ai_special=guardian
			type="Kraken"
			x=9
			y=26
		[/unit]
		[unit]
			ai_special=guardian
			type="Kraken"
			x=8
			y=31
		[/unit]
		[unit]
			ai_special=guardian
			name=_"Kaesz"
			type="Saurian Javelineer"
			x=25
			y=5
		[/unit]
		[unit]
			ai_special=guardian
			name=_"Mazziil"
			type="Saurian Javelineer"
			x=23
			y=5
		[/unit]
		[unit]
			ai_special=guardian
			type="Shadow Jumping Spider"
			x=35
			y=9
		[/unit]
		[unit]
			ai_special=guardian
			type="Shadow Jumping Spider"
			x=32
			y=12
		[/unit]
		[unit]
			ai_special=guardian
			type="Shadow Jumping Spider"
			x=32
			y=10
		[/unit]
		[unit]
			ai_special=guardian
			type="Shadow Jumping Spider"
			x=45
			y=11
		[/unit]
		[unit]
			ai_special=guardian
			type="Shadow Jumping Spider"
			x=43
			y=11
		[/unit]
		[unit]
			ai_special=guardian
			type="Shadow Jumping Spider"
			x=36
			y=6
		[/unit]
		[unit]
			ai_special=guardian
			type="Shadow Jumping Spider"
			x=38
			y=3
		[/unit]
		[unit]
			ai_special=guardian
			name=_"Keez"
			type="Saurian Javelineer"
			x=38
			y=4
		[/unit]
		[unit]
			ai_special=guardian
			name=_"Arexezz"
			type="Saurian Javelineer"
			x=34
			y=4
		[/unit]
		[unit]
			ai_special=guardian
			type="Kraken"
			x=40
			y=5
		[/unit]
	[/side]

	[side]
		no_leader=yes
		fog=no
		shroud=no
		side=4
		team_name=heroes,wildlife
		user_team_name="Humans"
		hidden=yes
	[/side]

	[event]
		name=prestart

		[if]
			[variable]
				name=entrance
				equals=1
			[/variable]
			[then]

				#ifdef EASY
				[terrain]
					x,y=8,41
					terrain=Ke
				[/terrain]
				[terrain]
					x=7,7,8,8,9,9
					y=41,42,40,42,41,42
					terrain=Ce
				[/terrain]
				[terrain]
					x=22
					y=30
					terrain=WufZ
				[/terrain]
				#endif

				#ifndef NORMAL
				[terrain]
					x,y=8,41
					terrain=Ke
				[/terrain]
				[terrain]
					x=7,7,9,9
					y=41,42,41,42
					terrain=Ce
				[/terrain]
				#endif

				#ifdef HARD
				[terrain]
					x,y=8,42
					terrain=Ke
				[/terrain]
				[terrain]
					x=7,9
					y=42,42
					terrain=Ce
				[/terrain]
				[terrain]
					x=21
					y=31
					terrain=Chw
				[/terrain]
				#endif
			[/then]
			[else]
				#ifdef EASY
				[terrain]
					x,y=29,48
					terrain=Ke
				[/terrain]
				[terrain]
					x=28,28,28,29,29,29
					y=46,47,48,46,47,49
					terrain=Ce
				[/terrain]
				[terrain]
					x=22
					y=30
					terrain=WufZ
				[/terrain]
				#endif

				#ifndef NORMAL
				[terrain]
					x,y=29,48
					terrain=Ke
				[/terrain]
				[terrain]
					x=28,28,29,29
					y=47,48,47,49
					terrain=Ce
				[/terrain]
				#endif

				#ifdef HARD
				[terrain]
					x,y=29,49
					terrain=Ke
				[/terrain]
				[terrain]
					x=28,29
					y=48,48
					terrain=Ce
				[/terrain]
				[terrain]
					x=21
					y=31
					terrain=Chw
				[/terrain]
				#endif
			[/else]
		[/if]
	[/event]

	[event]
		name=start
		[if]
			[variable]
				name=entrance
				equals=1
			[/variable]
			[then]
				[modify_side]
					side=2
					income=21
					{GOLD 0 100 672}
				[/modify_side]
			[/then]
		[/if]
		[if]
			[variable]
				name=quest_Oboavlidlu
				equals=0
			[/variable]
			[then]
				[message]
					speaker=Io
					message="Looks like those tunnels have been abandonned for a while."
				[/message]
				[message]
					speaker=Io
					message="On the other hand, I don't see much dust, so it seems we are not the first ones going there, humans or creatures."
				[/message]
				[message]
					speaker=Io
					message="Lets look for a way out and hope it takes us closer to our goal."
				[/message]
			[/then]
			[else]
				[message]
					speaker=Io
					message="So those are the famous flooded tunnels. They don't look so flooded from here, although the air is quite moist."
				[/message]
				[message]
					speaker=Io
					message="Our goal is to find the treasure hunters and then report back to Oboavlidlu."
				[/message]
				[message]
					speaker=Io
					message="Let's make it quick, our main mission is of dire importance."
				[/message]
			[/else]
		[/if]
	[/event]

	[event]
		name=moveto
		first_time_only=no
		[filter]
			side=1
			x=29,28,29
			y=43,41,41
		[/filter]
		[if]
			[have_location]
				x=29
				y=42
				terrain=Xoa
			[/have_location]
			[then]
				[message]
					speaker=unit
					message="This wall looks more recent. Should I tried to demolish it?"
					[option]
						message="Yes, please."
						[command]
							[terrain]
								x=29
								y=42
								terrain=Isa^Dr
							[/terrain]
							[redraw]
								side=1
							[/redraw]
							[message]
								speaker=unit
								message="Looks like there's a romm on the other side. "
							[/message]
						[/command]
					[/option]
					[option]
						message="We don't have the tools for that."
					[/option]
				[/message]
			[/then]
		[/if]
	[/event]

	[event]
		name=moveto
		first_time_only=no
		[filter]
			side=1
			x=27,27
			y=36,36
		[/filter]
		[if]
			[have_location]
				x=26
				y=36
				terrain=Wufz^Pr/
			[/have_location]
			[then]
				[message]
					speaker=unit
					message="There is a huge metal door. Should I open it?"
					[option]
						message="Yes, please."
						[command]
							[terrain]
								x=26
								y=36
								terrain=Wufz^Pr/o
							[/terrain]
							[redraw]
								side=1
							[/redraw]
							[message]
								speaker=unit
								message="It's opened."
							[/message]
						[/command]
					[/option]
					[option]
						message="No, not right now."
					[/option]
				[/message]
			[/then]
		[/if]
	[/event]

	[event]
		name=moveto
		first_time_only=no
		[filter]
			side=1
			x=40,40,42,42
			y=23,24,23,24
		[/filter]
		[if]
			[have_location]
				x=41
				y=24
				terrain=Wufz^Pr\
			[/have_location]
			[then]
				[message]
					speaker=unit
					message="There is a huge metal door. Should I open it?"
					[option]
						message="Yes, please."
						[command]
							[terrain]
								x=41
								y=24
								terrain=Wufz^Pr\o
							[/terrain]
							[redraw]
								side=1
							[/redraw]
							[message]
								speaker=unit
								message="It's opened."
							[/message]
						[/command]
					[/option]
					[option]
						message="No, not right now."
					[/option]
				[/message]
			[/then]
		[/if]
	[/event]

	[event]
		name=moveto
		first_time_only=no
		[filter]
			side=1
			x=43,43
			y=21,22
		[/filter]
		[if]
			[have_location]
				x=43
				y=21
				terrain=Wufz^Pr\
			[/have_location]
			[then]
				[message]
					speaker=unit
					message="There is a huge metal door. Should I open it?"
					[option]
						message="Yes, please."
						[command]
							[terrain]
								x=43
								y=21
								terrain=Wufz^Pr\o
							[/terrain]
							[redraw]
								side=1
							[/redraw]
							[message]
								speaker=unit
								message="It's opened."
							[/message]
						[/command]
					[/option]
					[option]
						message="No, not right now."
					[/option]
				[/message]
			[/then]
		[/if]
	[/event]

	[event]
		name=moveto
		first_time_only=no
		[filter]
			side=1
			x=37,38,39
			y=15,14,15
		[/filter]
		[if]
			[have_location]
				x=38
				y=15
				terrain=Isa^Pr|
			[/have_location]
			[then]
				[message]
					speaker=unit
					message="There is a huge metal door. Should I open it?"
					[option]
						message="Yes, please."
						[command]
							[terrain]
								x=38
								y=15
								terrain=Isa^Pr|o
							[/terrain]
							[redraw]
								side=1
							[/redraw]
							[message]
								speaker=unit
								message="It's opened."
							[/message]
						[/command]
					[/option]
					[option]
						message="No, not right now."
					[/option]
				[/message]
			[/then]
		[/if]
	[/event]

	[event]
		name=moveto
		first_time_only=no
		[filter]
			side=1
			x=8
			y=27
		[/filter]
		[if]
			[have_location]
				x=7
				y=28
				terrain=Isa^Pr\
			[/have_location]
			[have_location]
				x=9
				y=28
				terrain=Isa^Pr/
			[/have_location]
			[then]
				[message]
					speaker=unit
					message="There are two huge metal doors. Should I open them?"
					[option]
						message="Yes, please."
						[command]
							[terrain]
								x=7
								y=28
								terrain=Isa^Pr\o
							[/terrain]
							[terrain]
								x=9
								y=28
								terrain=Isa^Pr/o
							[/terrain]
							[redraw]
								side=1
							[/redraw]
							[if]
								[variable]
									name=entrance
									equals=2
								[/variable]
								[then]
									[modify_side]
										side=2
										income=21
										{GOLD 0 100 672}
									[/modify_side]
								[/then]
							[/if]
							[message]
								speaker=unit
								message="There're opened."
							[/message]
						[/command]
					[/option]
					[option]
						message="No, not right now."
					[/option]
				[/message]
			[/then]
		[/if]
	[/event]

	[event]
		name=moveto
		first_time_only=no
		[filter]
			side=1
			x=6,7,7,8
			y=28,27,29,27
		[/filter]
		[if]
			[have_location]
				x=7
				y=28
				terrain=Isa^Pr\
			[/have_location]
			[then]
				[message]
					speaker=unit
					message="There is a huge metal door. Should I open it?"
					[option]
						message="Yes, please."
						[command]
							[terrain]
								x=7
								y=28
								terrain=Isa^Pr\o
							[/terrain]
							[redraw]
								side=1
							[/redraw]
							[if]
								[variable]
									name=entrance
									equals=2
								[/variable]
								[then]
									[modify_side]
										side=2
										income=21
										{GOLD 0 100 672}
									[/modify_side]
								[/then]
							[/if]
							[message]
								speaker=unit
								message="It's opened."
							[/message]
						[/command]
					[/option]
					[option]
						message="No, not right now."
					[/option]
				[/message]
			[/then]
		[/if]
	[/event]

	[event]
		name=moveto
		first_time_only=no
		[filter]
			side=1
			x=9,9,10,8
			y=27,29,28,27
		[/filter]
		[if]
			[have_location]
				x=9
				y=28
				terrain=Isa^Pr/
			[/have_location]
			[then]
				[message]
					speaker=unit
					message="There is a huge metal door. Should I open it?"
					[option]
						message="Yes, please."
						[command]
							[terrain]
								x=9
								y=28
								terrain=Isa^Pr/o
							[/terrain]
							[redraw]
								side=1
							[/redraw]
							[if]
								[variable]
									name=entrance
									equals=2
								[/variable]
								[then]
									[modify_side]
										side=2
										income=21
										{GOLD 0 100 672}
									[/modify_side]
								[/then]
							[/if]
							[message]
								speaker=unit
								message="It's opened."
							[/message]
						[/command]
					[/option]
					[option]
						message="No, not right now."
					[/option]
				[/message]
			[/then]
		[/if]
	[/event]

	[event]
		name=moveto
		first_time_only=no
		[filter]
			side=1
			x=35
			y=14
		[/filter]
		[if]
			[have_location]
				x=35
				y=13
				terrain=Isa^Pr/
			[/have_location]
			[then]
				[message]
					speaker=unit
					message="There is a huge metal door. Should I open it?"
					[option]
						message="Yes, please."
						[command]
							[terrain]
								x=35
								y=13
								terrain=Isa^Pr/o
							[/terrain]
							[redraw]
								side=1
							[/redraw]
							[message]
								speaker=unit
								message="It's opened."
							[/message]
						[/command]
					[/option]
					[option]
						message="No, not right now."
					[/option]
				[/message]
			[/then]
		[/if]
	[/event]

	[event]
		name=enter hex
		[filter]
			side=1
			x=38,38
			y=7,12
		[/filter]
		[message]
			speaker=unit
			message="There's a corpse in there."
		[/message]
		[if]
			[variable]
				name=quest_Oboavlidlu
				equals=1
			[/variable]
			[then]
				[message]
					speaker=Io
					message="I'm afraid it is one of the treasure hunter we were supposed to look for. He was probably killed by the saurians."
				[/message]
				[message]
					speaker=Io
					message="Let's go back to the surface and warn Oboavlidlu so that he can give them a decent burial."
				[/message]
				{VARIABLE quest_Oboavlidlu 2}
			[/then]
			[else]
				[message]
					speaker=Io
					message="Poor fellow. It looks like he was killed by the saurians."
				[/message]
			[/else]
		[/if]
	[/event]

	[event]
		name=moveto
		first_time_only=no
		[filter]
			side=1
			x=41,41,42
			y=12,14,12
		[/filter]
		[if]
			[have_location]
				x=41
				y=13
				terrain=Isa^Pr\
			[/have_location]
			[then]
				[message]
					speaker=unit
					message="There is a huge metal door. Should I open it?"
					[option]
						message="Yes, please."
						[command]
							[terrain]
								x=41
								y=13
								terrain=Isa^Pr\o
							[/terrain]
							[redraw]
								side=1
							[/redraw]
							[message]
								speaker=unit
								message="It's opened."
							[/message]
						[/command]
					[/option]
					[option]
						message="No, not right now."
					[/option]
				[/message]
			[/then]
		[/if]
	[/event]

	[event]
		name=moveto
		first_time_only=no
		[filter]
			side=1
			x=45,45
			y=9,10
		[/filter]
		[if]
			[have_location]
				x=46
				y=9
				terrain=Xu
			[/have_location]
			[then]
				[message]
					speaker=unit
					message="It looks like this wall is made of earth. Should I try to dig through?"
					[option]
						message="Yes, please."
						[command]
							[terrain]
								x=46
								y=9
								terrain=Isa
							[/terrain]
							[redraw]
								side=1
							[/redraw]
							[message]
								speaker=unit
								message="There seems to be a corridor behind."
							[/message]
						[/command]
					[/option]
					[option]
						message="No, we don't have the tools for that."
					[/option]
				[/message]
			[/then]
		[/if]
	[/event]

	[event]
		name=moveto
		first_time_only=no
		[filter]
			side=1
			x=54
			y=7
		[/filter]
		[if]
			[variable]
				name=lever1
				equals=0
			[/variable]
			[then]
				[message]
					speaker=unit
					message="There is a lever on the wall. Should I pull it down?"
					[option]
						message="Yes, please."
						[command]
							[if]
								[variable]
									name=wheel_east
									equals=1
								[/variable]
								[variable]
									name=wheel_north
									equals=1
								[/variable]
								[variable]
									name=wheel_west
									equals=1
								[/variable]
								[variable]
									name=wheel_south
									equals=1
								[/variable]
								[variable]
									name=lever2
									equals=0
								[/variable]
								[then]
									{VARIABLE lever1 1}
									{REMOVE_IMAGE 54 7}
									{PLACE_IMAGE scenery/wall-switch-down.png 54 7}
									{PLACE_IMAGE scenery/wall-switch-up.png 53 8}
									[message]
										speaker=unit
										message="A second lever appear on the wall."
									[/message]
								[/then]
								[else]
									[message]
										speaker=unit
										message="It's blocked."
									[/message]
								[/else]
							[/if]
						[/command]
					[/option]
					[option]
						message="No, not right now."
					[/option]
				[/message]
			[/then]
			[else]
				[message]
					speaker=unit
					message="There is a lever on the wall. Should I pull it up?"
					[option]
						message="Yes, please."
						[command]
							[message]
								speaker=unit
								message="It's blocked."
							[/message]
						[/command]
					[/option]
					[option]
						message="No, not right now."
					[/option]
				[/message]
			[/else]
		[/if]
	[/event]

	[event]
		name=moveto
		first_time_only=no
		[filter]
			side=1
			x=41,41,42
			y=12,14,12
		[/filter]
		[if]
			[variable]
				name=lever1
				equals=1
			[/variable]
			[then]
				[if]
					[variable]
						name=lever2
						equals=0
					[/variable]
					[then]
						[message]
							speaker=unit
							message="There is a lever on the wall. Should I pull it down?"
							[option]
								message="Yes, please."
								[command]
									{VARIABLE lever2 1}
									{REMOVE_IMAGE 53 8}
									{PLACE_IMAGE scenery/wall-switch-down.png 53 8}
									[terrain]
										x=54
										y=12
										terrain=Isa
									[/terrain]
									[redraw]
										side=1
									[/redraw]
									[message]
										speaker=unit
										message="Part of the opposite wall slid down."
									[/message]
								[/command]
							[/option]
							[option]
								message="No, not right now."
							[/option]
						[/message]
					[/then]
					[else]
						[message]
							speaker=unit
							message="There is a lever on the wall. Should I pull it up?"
							[option]
								message="Yes, please."
								[command]
									[message]
										speaker=unit
										message="It's blocked."
									[/message]
								[/command]
							[/option]
							[option]
								message="No, not right now."
							[/option]
						[/message]
					[/else]
				[/if]
			[/then]
		[/if]
	[/event]

	[event]
		name=enter_hex
		[filter]
			side=1
			x,y=64,9
		[/filter]
		[remove_shroud]
			x=65-72
			y=3-11
		[/remove_shroud]
		[message]
			speaker=unit
			message="What's that?"
		[/message]
		[if]
			[have_unit]
				id=Amin
			[/have_unit]
			[then]
				[store_unit]
					variable=amin_store
					[filter]
						id=Amin
					[/filter]
				[/store_unit]
				[message]
					speaker=Amin
					message="Goblin contraption, that's what it is. Let me grab my hammer."
				[/message]
				[message]
					speaker=Idaamub
					message="Wait! What's the purpose of it?"
				[/message]
				[message]
					speaker=Amin
					message="Who cares? I say we remove it for the undersurface of the earth."
				[/message]
				[message]
					speaker=Idaamub
					message="Amin..."
				[/message] 
				[message]
					speaker=Amin
					message="Ok, ok. It looks like a giant steam engine. And it looks like it is running. I have no idea what it powers though."
				[/message]
				[message]
					speaker=Idaamub
					message="What's a steam engine?"
				[/message]
				[message]
					speaker=Amin
					message="A device that produces mechanical energy with water and fire. But I would in no way trust one of goblin fabrication, it could explode anytime, killing everyone in the tunnels."
				[/message]
				[message]
					speaker=Io
					message="But you understand how it works, don't you?"
				[/message]
				[message]
					speaker=Amin
					message="I know a normal one works, not the weird goblin death machines. But I can have a look if you want. It will not be said that a dwarf will fail to understand how an engine works, be it a goblin one."
				[/message]
				[message]
					speaker=Io
					message="Please do."
				[/message]
				{MOVE_UNIT id=Amin 69 10}
				[delay]
					time=700
				[/delay]
				{MOVE_UNIT id=Amin 72 7}
				[delay]
					time=700
				[/delay]
				{MOVE_UNIT id=Amin 69 4}
				[delay]
					time=700
				[/delay]
				{MOVE_UNIT id=Amin 66 7}
				[delay]
					time=700
				[/delay]
				{MOVE_UNIT id=Amin $amin_store.x amin_store.y}
				{CLEAR_VARIABLE amin_store}
				[message]
					speaker=Amin
					message="I have never seen such a terrible job at making an engine. I have no idea how it has not exploded yet. I assume the numerous leaks prevent the pressure from rising high enough to do so.
					Anyway, if you really want to make it do whatever it is supposed to, you should turn the four big wheel that are placed on each side of the engine. Then Of bless us for what will happen."
				[/message]				
				{HIGHLIGHT_IMAGE 69 10 items/gohere.png ()}
				{HIGHLIGHT_IMAGE 72 7 items/gohere.png ()}
				{HIGHLIGHT_IMAGE 69 4 items/gohere.png ()}
				{HIGHLIGHT_IMAGE 66 7 items/gohere.png ()}
			[/then]
			[else]
				[message]
					speaker=Io
					message="It looks a bit like the goblin engines. I wonder what it does and how it ended up here."
				[/message]
				[message]
					speaker=unit
					message="It looks like there some kind of big wheel on each side."
				[/message]
				[message]
					speaker=Io
					message="Maybe something will happen if we turn each of them."
				[/message]
				{HIGHLIGHT_IMAGE 69 10 items/gohere.png ()}
				{HIGHLIGHT_IMAGE 72 7 items/gohere.png ()}
				{HIGHLIGHT_IMAGE 69 4 items/gohere.png ()}
				{HIGHLIGHT_IMAGE 66 7 items/gohere.png ()}
			[/else]
		[/if]
	[/event]

	[event]
		name=moveto
		first_time_only=no
		[filter]
			side=1
			x=69
			y=10
		[/filter]
		[if]
			[variable]
				name=wheel_south
				equals=0
			[/variable]
			[then]
				[message]
					speaker=unit
					message="There is a huge wheel. Should I turn it?"
					[option]
						message="Yes, please."
						[command]
							{VARIABLE wheel_south 1}
							{REMOVE_IMAGE 69 10}
							[message]
								speaker=unit
								message="It's opened."
							[/message]
						[/command]
					[/option]
					[option]
						message="No, not right now."
					[/option]
				[/message]
			[/then]
		[/if]
	[/event]

	[event]
		name=moveto
		first_time_only=no
		[filter]
			side=1
			x=72
			y=7
		[/filter]
		[if]
			[variable]
				name=wheel_east
				equals=0
			[/variable]
			[then]
				[message]
					speaker=unit
					message="There is a huge wheel. Should I turn it?"
					[option]
						message="Yes, please."
						[command]
							{VARIABLE wheel_east 1}
							{REMOVE_IMAGE 72 7}
							[message]
								speaker=unit
								message="It's opened."
							[/message]
						[/command]
					[/option]
					[option]
						message="No, not right now."
					[/option]
				[/message]
			[/then]
		[/if]
	[/event]

	[event]
		name=moveto
		first_time_only=no
		[filter]
			side=1
			x=69
			y=4
		[/filter]
		[if]
			[variable]
				name=wheel_north
				equals=0
			[/variable]
			[then]
				[message]
					speaker=unit
					message="There is a huge wheel. Should I turn it?"
					[option]
						message="Yes, please."
						[command]
							{VARIABLE wheel_north 1}
							{REMOVE_IMAGE 69 4}
							[message]
								speaker=unit
								message="It's opened."
							[/message]
						[/command]
					[/option]
					[option]
						message="No, not right now."
					[/option]
				[/message]
			[/then]
		[/if]
	[/event]

	[event]
		name=moveto
		first_time_only=no
		[filter]
			side=1
			x=66
			y=7
		[/filter]
		[if]
			[variable]
				name=wheel_west
				equals=0
			[/variable]
			[then]
				[message]
					speaker=unit
					message="There is a huge wheel. Should I turn it?"
					[option]
						message="Yes, please."
						[command]
							{VARIABLE wheel_west 1}
							{REMOVE_IMAGE 66 7}
							[message]
								speaker=unit
								message="It's opened."
							[/message]
						[/command]
					[/option]
					[option]
						message="No, not right now."
					[/option]
				[/message]
			[/then]
		[/if]
	[/event]

	[event]
		name=moveto
		first_time_only=no
		[filter]
			side=1
			x=29,8
			y=29,43,44,45,46,47,48,49,50
		[/filter]
		[message]
			speaker=unit
			message="Should we go?"
			[option]
				[show_if]
					[and]
						[variable]
							name=quest_Oboavlidlu
							equals=0
						[/variable]
						[variable]
							name=entrance
							equals=1
						[/variable]
						[variable]
							name=x1
							equals=8
						[/variable]
					[/and]
					[or]
						[variable]
							name=quest_Oboavlidlu
							equals=0
						[/variable]
						[variable]
							name=entrance
							equals=2
						[/variable]
						[variable]
							name=x1
							equals=29
						[/variable]
					[/or]
				[/show_if]
				message="Yes, we are wasting our time here."
				[command]
					[message]
						speaker=Io
						message="Let's go back and take the main road instead."
					[/message]
					{VARIABLE_OP food_counter add 1}
					[endlevel]
						result=victory
						bonus=no
					[/endlevel]
				[/command]
			[/option]
			[option]
				[show_if]
					[and]
						[variable]
							name=quest_Oboavlidlu
							equals=0
						[/variable]
						[variable]
							name=entrance
							equals=1
						[/variable]
						[variable]
							name=x1
							equals=8
						[/variable]
					[/and]
					[or]
						[variable]
							name=quest_Oboavlidlu
							equals=0
						[/variable]
						[variable]
							name=entrance
							equals=2
						[/variable]
						[variable]
							name=x1
							equals=29
						[/variable]
					[/or]
				[/show_if]
				message="No, I am sure there is another exit."
				[command]
				[/command]
			[/option]
			[option]
				[show_if]
					[and]
						[variable]
							name=quest_Oboavlidlu
							equals=0
						[/variable]
						[variable]
							name=entrance
							equals=1
						[/variable]
						[variable]
							name=x1
							equals=29
						[/variable]
					[/and]
					[or]
						[variable]
							name=quest_Oboavlidlu
							equals=0
						[/variable]
						[variable]
							name=entrance
							equals=2
						[/variable]
						[variable]
							name=x1
							equals=8
						[/variable]
					[/or]
				[/show_if]
				message="Yes, this exit should bring us closer to our goal."
				[command]
					{FADE_TO_BLACK}
					[hide_unit]
					[/hide_unit]

					[remove_item]
					[/remove_item]

					[replace_map]
						map="{~add-ons/Legends_of_Idaamub/maps/35_Scavengers_Trading_Post.map}"
						expand=yes
						shrink=yes
					[/replace_map]

					[kill]
						side=2,3
					[/kill]

					[store_unit]
						[filter]
							side=1
						[/filter]
						variable=to_teleport
					[/store_unit]

					[unit]
						id=Durissa
						side=4
						ai_special=guardian
						name=_"Durissa"
						type="Pikeman"
						x=20
						y=24
					[/unit]
					[unit]
						id=Alealyan
						side=4
						ai_special=guardian
						name=_"Alealyan"
						type="Swordsman"
						x=21
						y=24
					[/unit]
					[unit]
						ai_special=guardian
						side=4
						id=trader
						name=_"Oddaty, the Scavenger"
						type="Rogue"
						x=21
						y=24
					[/unit]
					[unit]
						ai_special=guardian
						side=4
						id=Oboavlidlu
						name=_"Oboavlidlu"
						type="Trapper"
						x=21
						y=24
					[/unit]

					[if]
						[variable]
							name=entrance
							equals=1
						[/variable]
						[then]
							[scroll_to]
								x,y=15,11
							[/scroll_to]
							[foreach]
								array=to_teleport
								[do]
									[teleport]
										[filter]
											id=$this_item.id
										[/filter]
										x,y=15,11
									[/teleport]
								[/do]
							[/foreach]
						[/then]
						[else]
							[scroll_to]
								x,y=6,8
							[/scroll_to]
							[foreach]
								array=to_teleport
								[do]
									[teleport]
										[filter]
											id=$this_item.id
										[/filter]
										x,y=6,8
									[/teleport]
								[/do]
							[/foreach]
						[/else]
					[/if]
					{CLEAR_VARIABLE to_teleport}

					[modify_side]
						side=1
						shroud_data=$stored_side.shroud_data
					[/modify_side]
					{CLEAR_VARIABLE stored_side}

					[redraw]
					[/redraw]

					[unhide_unit]
					[/unhide_unit]
					{FADE_IN}
					[message]
						speaker=Io
						message="Well, it looks like I was wrong, this was not a shortcut."
					[/message]
					[message]
						speaker=Io
						message="I have been misled by all the tunnels and caves we have used as shortcut or detour since the beginning of our journey."
					[/message]
					[message]
						speaker=Io
						message="Let's continue on the main road instead."
					[/message]
					{VARIABLE_OP food_counter add 1}
					[endlevel]
						result=victory
						bonus=no
					[/endlevel]
				[/command]
			[/option]
			[option]
				[show_if]
					[and]
						[variable]
							name=quest_Oboavlidlu
							equals=0
						[/variable]
						[variable]
							name=entrance
							equals=1
						[/variable]
						[variable]
							name=x1
							equals=29
						[/variable]
					[/and]
					[or]
						[variable]
							name=quest_Oboavlidlu
							equals=0
						[/variable]
						[variable]
							name=entrance
							equals=2
						[/variable]
						[variable]
							name=x1
							equals=8
						[/variable]
					[/or]
				[/show_if]
				message="No, not yet."
				[command]
				[/command]
			[/option]
			[option]
				[show_if]
					[and]
						[variable]
							name=quest_Oboavlidlu
							equals=1
						[/variable]
						[variable]
							name=entrance
							equals=1
						[/variable]
						[variable]
							name=x1
							equals=8
						[/variable]
					[/and]
					[or]
						[variable]
							name=quest_Oboavlidlu
							equals=1
						[/variable]
						[variable]
							name=entrance
							equals=2
						[/variable]
						[variable]
							name=x1
							equals=29
						[/variable]
					[/or]
				[/show_if]
				message="Yes, we are wasting our time here."
				[command]
					[message]
						speaker=Io
						message="There is no sign of the treasure hunters and our mission is urgent."
					[/message]
					[message]
						speaker=Io
						message="Let's go back and continue down the old temple road."
					[/message]
					{FADE_TO_BLACK}
					[hide_unit]
					[/hide_unit]

					[remove_item]
					[/remove_item]

					[replace_map]
						map="{~add-ons/Legends_of_Idaamub/maps/35_Scavengers_Trading_Post.map}"
						expand=yes
						shrink=yes
					[/replace_map]

					[kill]
						side=2,3
					[/kill]

					[store_unit]
						[filter]
							side=1
						[/filter]
						variable=to_teleport
					[/store_unit]

					[unit]
						id=Durissa
						side=4
						ai_special=guardian
						name=_"Durissa"
						type="Pikeman"
						x=20
						y=24
					[/unit]
					[unit]
						id=Alealyan
						side=4
						ai_special=guardian
						name=_"Alealyan"
						type="Swordsman"
						x=21
						y=24
					[/unit]
					[unit]
						ai_special=guardian
						side=4
						id=trader
						name=_"Oddaty, the Scavenger"
						type="Rogue"
						x=21
						y=24
					[/unit]
					[unit]
						ai_special=guardian
						side=4
						id=Oboavlidlu
						name=_"Oboavlidlu"
						type="Trapper"
						x=21
						y=24
					[/unit]

					[if]
						[variable]
							name=entrance
							equals=1
						[/variable]
						[then]
							[scroll_to]
								x,y=15,11
							[/scroll_to]
							[foreach]
								array=to_teleport
								[do]
									[teleport]
										[filter]
											id=$this_item.id
										[/filter]
										x,y=15,11
									[/teleport]
								[/do]
							[/foreach]
							[teleport]
								[filter]
									id=Oboavlidlu
									x,y=15,11
								[/filter]
							[/teleport]
						[/then]
						[else]
							[scroll_to]
								x,y=6,8
							[/scroll_to]
							[foreach]
								array=to_teleport
								[do]
									[teleport]
										[filter]
											id=$this_item.id
										[/filter]
										x,y=6,8
									[/teleport]
								[/do]
							[/foreach]
							[teleport]
								[filter]
									id=Oboavlidlu
									x,y=6,8
								[/filter]
							[/teleport]
						[/else]
					[/if]
					{CLEAR_VARIABLE to_teleport}

					[modify_side]
						side=1
						shroud_data=$stored_side.shroud_data
					[/modify_side]
					{CLEAR_VARIABLE stored_side}

					[redraw]
					[/redraw]

					[unhide_unit]
					[/unhide_unit]
					{FADE_IN}
					[message]
						speaker=Oboavlidlu
						message="Back already? Have you found the treasure hunters?"
					[/message]
					[message]
						spekaer=Io
						message="I'm sorry but we've seen no sign of that and we have to time to look longer after then."
					[/message]
					[message]
						speaker=Oboavlidlu
						message="I understand. Still, I hope we will find out what happened to them. In these difficult times, it would be regrettable to lose their... support."
					[/message]
					[message]
						speaker=Io
						message="Goodbye. Now, let's continue our journey down the old temple road."
					[/message]
					{VARIABLE_OP food_counter add 1}
					[endlevel]
						result=victory
						bonus=no
					[/endlevel]
				[/command]
			[/option]
			[option]
				[show_if]
					[and]
						[variable]
							name=quest_Oboavlidlu
							equals=1
						[/variable]
						[variable]
							name=entrance
							equals=1
						[/variable]
						[variable]
							name=x1
							equals=8
						[/variable]
					[/and]
					[or]
						[variable]
							name=quest_Oboavlidlu
							equals=1
						[/variable]
						[variable]
							name=entrance
							equals=2
						[/variable]
						[variable]
							name=x1
							equals=29
						[/variable]
					[/or]
				[/show_if]
				message="No, we have not found the treasure hunters yet."
				[command]
				[/command]
			[/option]
			[option]
				[show_if]
					[and]
						[variable]
							name=quest_Oboavlidlu
							equals=1
						[/variable]
						[variable]
							name=entrance
							equals=1
						[/variable]
						[variable]
							name=x1
							equals=29
						[/variable]
					[/and]
					[or]
						[variable]
							name=quest_Oboavlidlu
							equals=1
						[/variable]
						[variable]
							name=entrance
							equals=2
						[/variable]
						[variable]
							name=x1
							equals=8
						[/variable]
					[/or]
				[/show_if]
				message="Yes, this exit should bring us closer to our goal."
				[command]
					[message]
						speaker=Io
						message="There is no sign of the treasure hunters and our mission is too urgent to waste more time here."
					[/message]
					{FADE_TO_BLACK}
					[hide_unit]
					[/hide_unit]

					[remove_item]
					[/remove_item]

					[replace_map]
						map="{~add-ons/Legends_of_Idaamub/maps/35_Scavengers_Trading_Post.map}"
						expand=yes
						shrink=yes
					[/replace_map]

					[kill]
						side=2,3
					[/kill]

					[store_unit]
						[filter]
							side=1
						[/filter]
						variable=to_teleport
					[/store_unit]

					[unit]
						id=Durissa
						side=4
						ai_special=guardian
						name=_"Durissa"
						type="Pikeman"
						x=20
						y=24
					[/unit]
					[unit]
						id=Alealyan
						side=4
						ai_special=guardian
						name=_"Alealyan"
						type="Swordsman"
						x=21
						y=24
					[/unit]
					[unit]
						ai_special=guardian
						side=4
						id=trader
						name=_"Oddaty, the Scavenger"
						type="Rogue"
						x=21
						y=24
					[/unit]
					[unit]
						ai_special=guardian
						side=4
						id=Oboavlidlu
						name=_"Oboavlidlu"
						type="Trapper"
						x=21
						y=24
					[/unit]

					[if]
						[variable]
							name=entrance
							equals=1
						[/variable]
						[then]
							[scroll_to]
								x,y=15,11
							[/scroll_to]
							[foreach]
								array=to_teleport
								[do]
									[teleport]
										[filter]
											id=$this_item.id
										[/filter]
										x,y=15,11
									[/teleport]
								[/do]
							[/foreach]
							[teleport]
								[filter]
									id=Oboavlidlu
									x,y=15,11
								[/filter]
							[/teleport]
						[/then]
						[else]
							[scroll_to]
								x,y=6,8
							[/scroll_to]
							[foreach]
								array=to_teleport
								[do]
									[teleport]
										[filter]
											id=$this_item.id
										[/filter]
										x,y=6,8
									[/teleport]
								[/do]
							[/foreach]
							[teleport]
								[filter]
									id=Oboavlidlu
									x,y=6,8
								[/filter]
							[/teleport]
						[/else]
					[/if]
					{CLEAR_VARIABLE to_teleport}

					[modify_side]
						side=1
						shroud_data=$stored_side.shroud_data
					[/modify_side]
					{CLEAR_VARIABLE stored_side}

					[redraw]
					[/redraw]

					[unhide_unit]
					[/unhide_unit]
					{FADE_IN}
					[message]
						speaker=Io
						message="Well, it looks like I was wrong, this was not a shortcut."
					[/message]
					[message]
						speaker=Io
						message="I have been misled by all the tunnels and caves we have used as shortcut or detour since the beginning of our journey."
					[/message]
					[message]
						speaker=Io
						message="Let's continue on the main road instead."
					[/message]
					[message]
						speaker=Oboavlidlu
						message="Back already? Have you found the treasure hunters?"
					[/message]
					[message]
						spekaer=Io
						message="I'm sorry but we've seen no sign of that and we have to time to look longer after then."
					[/message]
					[message]
						speaker=Oboavlidlu
						message="I understand. Still, I hope we will find out what happened to them. In these difficult times, it would be regrettable to lose their... support."
					[/message]
					[message]
						speaker=Io
						message="Goodbye. Now, let's continue our journey down the old temple road."
					[/message]
					{VARIABLE_OP food_counter add 1}
					[endlevel]
						result=victory
						bonus=no
					[/endlevel]
				[/command]
			[/option]
			[option]
				[show_if]
					[and]
						[variable]
							name=quest_Oboavlidlu
							equals=1
						[/variable]
						[variable]
							name=entrance
							equals=1
						[/variable]
						[variable]
							name=x1
							equals=29
						[/variable]
					[/and]
					[or]
						[variable]
							name=quest_Oboavlidlu
							equals=1
						[/variable]
						[variable]
							name=entrance
							equals=2
						[/variable]
						[variable]
							name=x1
							equals=8
						[/variable]
					[/or]
				[/show_if]
				message="No, we have not found the treasure hunters yet."
				[command]
				[/command]
			[/option]
			[option]
				[show_if]
					[variable]
						name=quest_Oboavlidlu
						equals=2
					[/variable]
				[/show_if]
				message="Yes, we should go report to Oboavlidlu."
				[command]
					{FADE_TO_BLACK}
					[hide_unit]
					[/hide_unit]

					[remove_item]
					[/remove_item]

					[replace_map]
						map="{~add-ons/Legends_of_Idaamub/maps/35_Scavengers_Trading_Post.map}"
						expand=yes
						shrink=yes
					[/replace_map]

					[kill]
						side=2,3
					[/kill]

					[store_unit]
						[filter]
							side=1
						[/filter]
						variable=to_teleport
					[/store_unit]

					[unit]
						id=Durissa
						side=4
						ai_special=guardian
						name=_"Durissa"
						type="Pikeman"
						x=20
						y=24
					[/unit]
					[unit]
						id=Alealyan
						side=4
						ai_special=guardian
						name=_"Alealyan"
						type="Swordsman"
						x=21
						y=24
					[/unit]
					[unit]
						ai_special=guardian
						side=4
						id=trader
						name=_"Oddaty, the Scavenger"
						type="Rogue"
						x=21
						y=24
					[/unit]
					[unit]
						ai_special=guardian
						side=4
						id=Oboavlidlu
						name=_"Oboavlidlu"
						type="Trapper"
						x=21
						y=24
					[/unit]

					[if]
						[variable]
							name=entrance
							equals=1
						[/variable]
						[then]
							[scroll_to]
								x,y=15,11
							[/scroll_to]
							[foreach]
								array=to_teleport
								[do]
									[teleport]
										[filter]
											id=$this_item.id
										[/filter]
										x,y=15,11
									[/teleport]
								[/do]
							[/foreach]
							[teleport]
								[filter]
									id=Oboavlidlu
									x,y=15,11
								[/filter]
							[/teleport]
						[/then]
						[else]
							[scroll_to]
								x,y=6,8
							[/scroll_to]
							[foreach]
								array=to_teleport
								[do]
									[teleport]
										[filter]
											id=$this_item.id
										[/filter]
										x,y=6,8
									[/teleport]
								[/do]
							[/foreach]
							[teleport]
								[filter]
									id=Oboavlidlu
									x,y=6,8
								[/filter]
							[/teleport]
						[/else]
					[/if]
					{CLEAR_VARIABLE to_teleport}

					[modify_side]
						side=1
						shroud_data=$stored_side.shroud_data
					[/modify_side]
					{CLEAR_VARIABLE stored_side}

					[redraw]
					[/redraw]

					[unhide_unit]
					[/unhide_unit]
					{FADE_IN}
					[message]
						speaker=Oboavlidlu
						message="Back already? Have you found the treasure hunters?"
					[/message]
					[message]
						spekaer=Io
						message="I'm sorry but they are dead."
					[/message]
					[message]
						speaker=Oboavlidlu
						message="You found them dead? That’s marvelous!... Hmm... It is a bit unfortunate."
					[/message]
					[message]
						speaker=Oboavlidlu
						message="I knew they were not the kind to leave without saying goodbye. Please take this modest sum in return for your help."
					[/message]
					[gold]
						amount=35000
					[/gold]
					[message]
						speaker=Oboavlidlu
						message="Oddaty and I will have to go there without delay to make sure to provide a... hmm... decent burial to those poor lads."
					[/message]
					[message]
						speaker=Io
						message="Goodbye. Now, let's continue our journey down the old temple road."
					[/message]
					{VARIABLE_OP food_counter add 1}
					[endlevel]
						result=victory
						bonus=no
					[/endlevel]
				[/command]
			[/option]
			[option]
				[show_if]
					[variable]
						name=quest_Oboavlidlu
						equals=2
					[/variable]
				[/show_if]
				message="No, not yet."
				[command]
				[/command]
			[/option]
		[/message]
	[/event]

	[event]
		name=time over
		[message]
			speaker=Io
			message="We are wasting our time here."
		[/message]
		[if]
			[variable]
				name=quest_Oboavlidlu
				equals=0
			[/variable]
			[else]
				[message]
					speaker=Io
					message="There is no sign of the treasure hunters and our mission is urgent."
				[/message]
			[/else]
		[/if]
		[message]
			speaker=Io
			message="Let's go back and continue down the old temple road."
		[/message]
		{VARIABLE_OP food_counter add 1}
		[endlevel]
			result=victory
			bonus=no
		[/endlevel]
	[/event]

	[event]
		name=victory
		{CLEAR_VARIABLE quest_Oboavlidlu}
		{CLEAR_VARIABLE hunters_found}
		{CLEAR_VARIABLE lever1}
		{CLEAR_VARIABLE lever2}
		{CLEAR_VARIABLE wheel_east}
		{CLEAR_VARIABLE wheel_north}
		{CLEAR_VARIABLE wheel_west}
		{CLEAR_VARIABLE wheel_south}
	[/event]

	{DROPS 20 0 (bow, mace, polearm) yes 2,3}

	{DISABLE_NEGATIVE_INCOME 1}

	{GLOBAL_EVENTS}

[/scenario]

