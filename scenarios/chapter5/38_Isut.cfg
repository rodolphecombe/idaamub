#textdomain wesnoth-loi
[scenario]
	id="38_Isut"
	name= _ "Isut"
	map_data="{~add-ons/Legends_of_Idaamub/maps/38_Isut.map}"
	victory_when_enemies_defeated=no
	next_scenario=39_Oofs_Fortress

	{TURNS 25 25 25}

	{DEFAULT_SCHEDULE}
	{DEFAULT_MUSIC_PLAYLIST}

	[time_area]
		x=0-19
		y=0-8
		{UNDERGROUND}
	[/time_area]

	{PLACE_IMAGE scenery/signpost.png 24 18}
	{PLACE_IMAGE scenery/signpost.png 33 16}
	{PLACE_IMAGE scenery/signpost.png 45 34}
	{PLACE_IMAGE items/bones.png 37 15}
	{PLACE_IMAGE items/bones.png 37 16}
	{PLACE_IMAGE items/bones.png 38 14}
	{PLACE_IMAGE items/bones.png 38 15}
	{PLACE_IMAGE items/bones.png 38 16}
	{PLACE_IMAGE items/bones.png 39 15}
	{PLACE_IMAGE items/bones.png 39 16}

	{BASIC_CHEST 2 4 (bow, staff, sword, axe, polearm)}

	[event]
        name=prestart

        [set_variable]
            name=scenario_number
            value=36
        [/set_variable]

        [objectives]
            side=1
            [objective]
                description= _ "Defeat Isut"
                [show_if]
                	[have_unit]
                		id=Isut
                	[/have_unit]
                [/show_if]
                condition=win
            [/objective]
            [objective]
                description= _ "Enter Oof's fortress"
                [show_if]
                	[not]
	                	[have_unit]
	                		id=Isut
	                	[/have_unit]
	                [/not]
                [/show_if]
                condition=win
            [/objective]
            [objective]
                {ALTERNATIVE_OBJECTIVE_CAPTION}
                description= _ "Defeat all undead"+{EARLY_FINISH_BONUS_FOOTNOTE}
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Io"
                condition=lose
            [/objective]
            {TURNS_RUN_OUT}

            [gold_carryover]
                bonus=yes
                carryover_percentage=100
            [/gold_carryover]
        [/objectives]

        {LOI_RECALL_ALL 19 36}
    [/event]

    [side]
        type="Young Man LoI"
        id=Io
        name= _ "Io"
        x=19
        y=36
        fog=yes
        shroud=yes
        profile=portraits/Io.png
        side=1
		defeat_condition=no_units_left
        canrecruit=yes
        controller=human
        team_name=heroes
        user_team_name=_"Heroes"
    [/side]

    [side]
		fog=no
		hidden=no
		income=73
		{GOLD 0 100 2794}
		no_leader=no
		recruit="Bewitched Wolf, Banebow, Draug"
		shroud=no
		side=2
		team_name=undead
		user_team_name=_"Undead"
		[unit]
			canrecruit=yes
			type="Deathlord LotI"
			x=24
			y=20
		[/unit]
	[/side]

	[side]
		fog=no
		hidden=no
		no_leader=no
		recruit="Bewitched Wolf, Banebow, Draug"
		shroud=no
		side=3
		team_name=undead
		user_team_name=_"Isut"
		[unit]
			canrecruit=yes
			id=Isut
			name="Commander Isut"
			type="Orcish Commander LoI"
			x=38
			y=15
		[/unit]
	[/side]

	[side]
		no_leader=yes
		fog=no
		shroud=no
		side=4
		team_name=undead
		user_team_name="Undead Hordes"
		[unit]
			ai_special=guardian
			type="Draug"
			x=32
			y=9
		[/unit]
		[unit]
			ai_special=guardian
			type="Draug"
			x=18
			y=12
		[/unit]
		[unit]
			ai_special=guardian
			type="Banebow"
			x=32
			y=14
		[/unit]
		[unit]
			ai_special=guardian
			type="Banebow"
			x=24
			y=14
		[/unit]
		[unit]
			ai_special=guardian
			type=" Bewitched Wolf"
			x=28
			y=13
		[/unit]
		[unit]
			ai_special=guardian
			type=" Bewitched Wolf"
			x=19
			y=15
		[/unit]
		[unit]
			ai_special=guardian
			type=" Bewitched Wolf"
			x=23
			y=11
		[/unit]
		[unit]
			ai_special=guardian
			type=" Bewitched Wolf"
			x=18
			y=9
		[/unit]
		[unit]
			ai_special=guardian
			type="Banebow"
			x=42
			y=34
		[/unit]
		[unit]
			ai_special=guardian
			type="Banebow"
			x=46
			y=33
		[/unit]
		[unit]
			ai_special=guardian
			type="Banebow"
			x=46
			y=27
		[/unit]
		[unit]
			ai_special=guardian
			type="Banebow"
			x=46
			y=23
		[/unit]
		[unit]
			ai_special=guardian
			type="Banebow"
			x=43
			y=22
		[/unit]
		[unit]
			ai_special=guardian
			type="Banebow"
			x=42
			y=25
		[/unit]
		[unit]
			ai_special=guardian
			type="Draug"
			x=45
			y=22
		[/unit]
		[unit]
			ai_special=guardian
			type="Draug"
			x=43
			y=33
		[/unit]
		[unit]
			ai_special=guardian
			type="Draug"
			x=43
			y=27
		[/unit]
		[unit]
			ai_special=guardian
			type=" Bewitched Wolf"
			x=46
			y=30
		[/unit]
		[unit]
			ai_special=guardian
			type=" Bewitched Wolf"
			x=42
			y=27
		[/unit]
		[unit]
			ai_special=guardian
			type=" Bewitched Wolf"
			x=43
			y=28
		[/unit]
		[unit]
			ai_special=guardian
			type=" Bewitched Wolf"
			x=44
			y=21
		[/unit]
		[unit]
			ai_special=guardian
			type=" Bewitched Wolf"
			x=42
			y=26
		[/unit]
		[unit]
			ai_special=guardian
			type=" Bewitched Wolf"
			x=45
			y=11
		[/unit]
		[unit]
			ai_special=guardian
			type=" Bewitched Wolf"
			x=38
			y=8
		[/unit]
		[unit]
			ai_special=guardian
			type=" Bewitched Wolf"
			x=42
			y=9
		[/unit]
		[unit]
			ai_special=guardian
			type=" Bewitched Wolf"
			x=46
			y=13
		[/unit]
		[unit]
			ai_special=guardian
			type=" Bewitched Wolf"
			x=46
			y=4
		[/unit]
		[unit]
			ai_special=guardian
			type="Banebow"
			x=45
			y=17
		[/unit]
		[unit]
			ai_special=guardian
			type="Banebow"
			x=41
			y=13
		[/unit]
		[unit]
			ai_special=guardian
			type="Banebow"
			x=41
			y=2
		[/unit]
		[unit]
			ai_special=guardian
			type="Draug"
			x=44
			y=12
		[/unit]
		[unit]
			ai_special=guardian
			type="Draug"
			x=40
			y=4
		[/unit]
		[unit]
			ai_special=guardian
			type="Draug"
			x=39
			y=9
		[/unit]
		[unit]
			ai_special=guardian
			type="Draug"
			x=42
			y=13
		[/unit]
		[unit]
			ai_special=guardian
			type="Draug"
			x=44
			y=10
		[/unit]
		[unit]
			ai_special=guardian
			type="Draug"
			x=43
			y=15
		[/unit]
		[unit]
			ai_special=guardian
			type="Draug"
			x=44
			y=15
		[/unit]
		[unit]
			ai_special=guardian
			type="Draug"
			x=38
			y=7
		[/unit]
	[/side]

	[side]
		no_leader=yes
		fog=no
		shroud=no
		side=5
		ai_algorithm=idle_ai
		team_name=heroes,undead
		user_team_name="Defenders"
		[unit]
			name=_"Athaubor"
			type="Dwarvish Steelclad"
			x=52
			y=12
		[/unit]
		[unit]
			name=_"Pelthasmarol"
			type="Dwarvish Steelclad"
			x=52
			y=14
		[/unit]
		[unit]
			name=_"Ubidaiubua"
			id=Ubidaiubua
			type="Red Mage"
			x=21
			y=32
		[/unit]
	[/side]

	[event]
		name=prestart

		#ifdef HARD
		[terrain]
			x=18,20
			y=36,36
			terrain=Gd
		[/terrain]
		[terrain]
			x=24,24
			y=19,21
			terrain=Chr
		[/terrain]
		#endif

		#ifdef EASY
		[terrain]
			x=19,19
			y=35,37
			terrain=Ce
		[/terrain]
		[terrain]
			x=28
			y=20
			terrain=Rd
		[/terrain]
		[terrain]
			x=25
			y=20
			terrain=Gd
		[/terrain]
		#endif
	[/event]

	[event]
		name=start
		[message]
			speaker=Io
			message="I'm glad to finally be out of this cave. It was oppressing."
		[/message]
		[message]
			speaker=Io
			message="Probably because of how old everything was in there."
		[/message]
		[message]
			speaker=Io
			message="And undead. Undead too. And tentacle monsters."
		[/message]
		[message]
			speaker=Io
			message="Anyway, we must not be far from the fortress now. We need to find Isut quickly and defeat him before the fortress fall."
		[/message]
	[/event]

	[event]
		name=moveto
		[filter]
			side=1
			x=24
			y=18
		[/filter]

		[message]
			speaker=narrator
			image="scenery/signpost.png"
			message= _ "East: Oof Fortress"
		[/message]

		[allow_undo]
		[/allow_undo]
	[/event]

	[event]
		name=moveto
		[filter]
			side=1
			x=33
			y=16
		[/filter]

		[message]
			speaker=narrator
			image="scenery/signpost.png"
			message= _ "East: Oof Fortress, Scavenger’s Trading Post
West: Eastern Swamp"
		[/message]

		[allow_undo]
		[/allow_undo]
	[/event]

	[event]
		name=moveto
		[filter]
			side=1
			x=45
			y=34
		[/filter]

		[message]
			speaker=narrator
			image="scenery/signpost.png"
			message= _ "North: Oof Fortress
South: Scavenger’s Trading Post"
		[/message]

		[allow_undo]
		[/allow_undo]
	[/event]

	[event]
		name=sighted
		[filter]
			type=Bewitched Wolf
		[/filter]

		[filter_second]
			side=1
		[/filter_second]
		[scroll_to]
			x,y=$x1,$y1
		[/scroll_to]
		[message]
			speaker=second_unit
			message= _ "That wolf looks weird."
		[/message]
		[message]
			speaker=second_unit
			message= _ "It looks as if it was possessed. Or rather as if something was wearing a wolf like a costume."
		[/message]
		[cancel_action]
		[/cancel_action]
	[/event]

	[event]
		name=enter_hex
		[filter]
			side=1
			x=34
		[/filter]
		[message]
			speaker=unit
			message="I found Isut!"
		[/message]
		[foreach]
			array=party_members
			[do]
				{MOVE_UNIT id=$this_item.id 35 16}
			[/do]
		[/foreach]
		[message]
			speaker=Isut
			message="Finally, adversaries to match up to myself. I thought I would die from boredom fighting those pathetic legionaries."
		[/message]
		[message]
			speaker=Isut
			message="We will see if you make better adversaries than the other humans."
		[/message]
		[terrain]
			x=33,33,33,39,40
			y=16,17,18,19,14
			terrain=Xu
		[/terrain]
		[terrain]
			{QUANTITY x 37 (37,38) (37,38)}
			{QUANTITY y 15 (15,14) (15,14)}
			terrain=Gd^Kov
		[/terrain]
		[terrain]
			{QUANTITY x 37 (37,38) (37,38,39,39)}
			{QUANTITY y 16 (16,16) (16,16,15,16)}
			terrain=Rd^Kov
		[/terrain]
		[modify_side]
			side=3
			income=23
			{GOLD 0 100 902}
		[/modify_side]
		[message]
			speaker=Io
			message="Well, looks like we are trapped. Not like we intended to flee anyway."
		[/message]
		[message]
			speaker=Io
			message="Fight!"
		[/message]
		[cancel_action]
		[/cancel_action]
		[end_turn]
		[/end_turn]
	[/event]

	[event]
		name=die
		[filter]
			id=Isut
		[/filter]
		[terrain]
			x=33,33
			y=16,18
			terrain=Gd
		[/terrain]
		[terrain]
			x=37,38,39,39,33,39,40
			y=16,16,15,16,17,19,14
			terrain=Rd
		[/terrain]
		[message]
			speaker=Io
			message="We did it! Isut is no more!"
		[/message]
		[if]
			[have_unit]
				side=4
				race=undead
				[filter_vision]
					side=1
				[/filter_vision]
			[/have_unit]
			[then]
				[message]
					speaker=Io
					message="Aren't his undead supposed to fall into dust or something?"
				[/message]
				[message]
					{MAGE_FILTER}
					message="They should be. But I am not versed in orcish necromancy so I could be wrong."
				[/message]
				[message]
					{MAGE_FILTER}
					message="They seems to wander aimlessly now at least, which means the fortress should be safe."
				[/message]
				[message]
					speaker=Io
					message="So, we did it?! We saved the fortress?! Hurray!"
				[/message]
				[message]
					speaker=Teumiuxe, Csia
					message="We should go there to meet Captain Soimaql now."
				[/message]
				[message]
					speaker=Io
					message="Shouldn't we kill the remaining undead before?"
				[/message]
			[/then]
			[else]
				[message]
					speaker=Io
					message="So, we did it?! We saved the fortress?! Hurray!"
				[/message]
				[message]
					speaker=Teumiuxe, Csia
					message="We should go there to meet Captain Soimaql now."
				[/message]
				[event]
					name=sighted
					[filter]
						side=4
						race=undead
					[/filter]
					[message]
						speaker=Io
						message="Aren't Isut undead supposed to haven fallen into dust or something?"
					[/message]
					[message]
						{MAGE_FILTER}
						message="They should have. But I am not versed in orcish necromancy so I could be wrong."
					[/message]
					[message]
						{MAGE_FILTER}
						message="They seems to wander aimlessly now at least, which means the fortress should be safe."
					[/message]
					[message]
					speaker=Io
					message="We should probably kill the remain undead anyway."
				[/message]
				[/event]
			[/else]
		[/if]
		[show_objectives]
		[/show_objectives]
	[/event]

	[event]
		name=moveto
		[filter]
			side=1
			x,y=42,33
		[/filter]
		[message]
			speaker=unit
			message="I found something in the house."
		[/message]
		{DEFAULT_DROP_ITEM 42 33 (bow,sword,staff,axe,polearm) 2}
	[/event]

	[event]
        name=moveto
        first_time_only=no
        [filter]
			side=1
			[filter_adjacent]
				id=Ubidaiubua
			[/filter_adjacent]
		[/filter]
        [if]
        	[have_unit]
        		id=Ubidaiubua
        		side=5
        	[/have_unit]
            [then]
                [fire_event]
                    name=Ubidaiubua_talk
                [/fire_event]
            [/then]
        [/if]
    [/event]

    [event]
        name=Ubidaiubua_talk
        first_time_only=no
        [message]
            speaker=Ubidaiubua
            message= _ "Hello."
            [option]
                message="Who are you?"
                [command]
                    [message]
                        speaker=Ubidaiubua
                        message= _ "I'm Ubidaiubua, a roving mage and a Traveler."
                    [/message]
                    [fire_event]
                        name=Ubidaiubua_talk
                        [primary_unit]
                            x,y=$x1,$y1
                        [/primary_unit]
                    [/fire_event]
                [/command]
            [/option]
            [option]
                message="What are you doing here?"
                [command]
                    [message]
                        speaker=Ubidaiubua
                        message= _ "Thoze foolz couldn’t even recognize their mother…I’ve an exzellent magic againzt the Ockz but thoze bloody legionariez don’t truzt me under the pretext that I’m a Traveler, a ztranger!"
                    [/message]
                    [message]
                        speaker=Ubidaiubua
                        message= _ "My couzin Bta is captive inside. I must make sure she’z alright."
                    [/message]
                    [fire_event]
                        name=Ubidaiubua_talk
                        [primary_unit]
                            x,y=$x1,$y1
                        [/primary_unit]
                    [/fire_event]
                [/command]
            [/option]
            [option] 
                message="Can we help you?"
                [command]
                    [store_gold]
                        side=1
                        variable=gold
                    [/store_gold]
                    [message]
                        speaker=Ubidaiubua
                        message= _ "Maybe they will let me in if I’m with you… "
                    [/message]
                    [message]
                        speaker=Ubidaiubua
                        message= _ "I’m willing to zell my zpells to YOU, for 390000."
                    [/message]
                    [message]
                        speaker=Ubidaiubua
                        message= _ "Deal?"
                        [option]
                            message="Deal"
                            [command]
                                [if]
                                	[variable]
                                		name=gold
                                		greater_than_equal_to=390000
                                	[/variable]
                                	[else]
                                		[message]
                                			speaker=Ubidaiubua
                                			message= _ "I am afraid you don't have enough gold for a mage like me."
                                		[/message]
                                	[/else]
                                	[then]
                                		[if]
                                			[variable]
                                				name=party_members.length
                                				numerical_equals=8
                                			[/variable]
                                			[then]
                                				[fire_event]
                                					name=party_full
                                				[/fire_event]
                                			[/then]
                                		[/if]
                                		[if]
                                			[variable]
                                				name=party_members.length
                                				numerical_equals=8
                                			[/variable]
                                			[then]
                                				[message]
                                					speaker=Ubidaiubua
                                					message="I am zorry, but you zeem to be quite a party already."
                                				[/message]
                                			[/then]
                                			[else]
                                				[gold]
                                					side=1
                                					amount=-38400
                                				[/gold]
                                				[modify_unit]
                                					[filter]
                                						id=Ubidaiubua
                                					[/filter]
                                					side=1
                                				[/modify_unit]
                                				[allow_recruit]
                                					side=1
                                					type=Red Mage
                                				[/allow_recruit]
                                				{VARIABLE party_members[$party_members.length].id Ubidaiubua}
                                					[message]
                                						speaker=Ubidaiubua
                                						message= _ "Ubidaiubua will remember you, pal! Thiz iz a promize!"
                                					[/message]
                                					[message]
                                						speaker=Ubidaiubua
                                						message= _ "Let’z go in the fortrezz together and zee what thre’z to zee!"
                                					[/message]
                                					[message]
                                						speaker=narrator
                                						message="You can now recruit red mages."
                                					[/message]
                                				[/else]
                                			[/if]
                                    [/then]
                                [/if]
                            [/command]
                        [/option]
                        [option]
                            message="Sorry, we don't have enough gold."
                            [command]
                                 [message]
                                    speaker=Ubidaiubua
                                    message= _ "Then, leave. You don’t trust Ubidaiubua."
                                [/message]
                                [message]
                                    speaker=Ubidaiubua
                                    message= _ "You’re not worthy of the zervicez of the wonderful roving mage I am."
                                [/message]
                            [/command]
                        [/option]
                        {CLEAR_VARIABLE gold}
                        [fire_event]
                            name=Ubidaiubua_talk
                            [primary_unit]
                                x,y=$x1,$y1
                            [/primary_unit]
                        [/fire_event]
                    [/message]
                [/command]
            [/option]
            [option]
                message="Leave"
            [/option]
        [/message]
    [/event]

    [event]
		name=moveto
		first_time_only=no
		[filter]
			side=1
			x=51
			y=14
		[/filter]
		[if]
			[variable]
				name=unit.variables.hero
				equals=yes
			[/variable]
			[then]
				[message]
					speaker=unit
					message= _ "Here is the fortress. Let's meet Captain Soimaql."
				[/message]
				{END_FOOD}
				[endlevel]
					bonus=no
					result=victory
					{NEW_GOLD_CARRYOVER 100}
				[/endlevel]
			[/then]
			[else]
				[message]
					speaker=Io
					message= _ "Wait for us! We are still fighting the undead here!"
				[/message]

				[allow_undo]
				[/allow_undo]
			[/else]
		[/if]
	[/event]

    [event]
    	name=die
    	first_time_only=no
    	[filter]
    		race=undead
    	[/filter]
    	[if]
    		[have_unit]
    			race=undead
    			[not]
    				side=1
    			[/not]
    		[/have_unit]
    		[else]
    			[message]
    				speaker=unit
    				message="I think it was the last undead around."
    			[/message]
    			[message]
    				speaker=Io
    				message="Let's go to the fortress then."
    			[/message]
    			{MOVE_UNIT id=Io 51 13}
    			{END_FOOD}
				[endlevel]
					result=victory
					bonus=yes
					{NEW_GOLD_CARRYOVER 100}
				[/endlevel]
    		[/else]
    	[/if]
    [/event]

    [event]
		name=time over
		[item]
			x,y=51,8
			name=flames
			halo="flame-big-A[01~08].png:140"
		[/item]
		[item]
			x,y=51,9
			name=flames
			halo="flame-big-A[01~08].png:140"
		[/item]
		[item]
			x,y=51,10
			name=flames
			halo="flame-big-A[01~08].png:140"
		[/item]
		[item]
			x,y=51,11
			name=flames
			halo="flame-big-A[01~08].png:140"
		[/item]
		[item]
			x,y=51,12
			name=flames
			halo="flame-big-A[01~08].png:140"
		[/item]
		[item]
			x,y=51,13
			name=flames
			halo="flame-big-A[01~08].png:140"
		[/item]
		[item]
			x,y=51,14
			name=flames
			halo="flame-big-A[01~08].png:140"
		[/item]
		[item]
			x,y=51,15
			name=flames
			halo="flame-big-A[01~08].png:140"
		[/item]
		[item]
			x,y=51,16
			name=flames
			halo="flame-big-A[01~08].png:140"
		[/item]
		[item]
			x,y=51,17
			name=flames
			halo="flame-big-A[01~08].png:140"
		[/item]
		[item]
			x,y=51,18
			name=flames
			halo="flame-big-A[01~08].png:140"
		[/item]
		[item]
			x,y=51,19
			name=flames
			halo="flame-big-A[01~08].png:140"
		[/item]
		[item]
			x,y=52,7
			name=flames
			halo="flame-big-A[01~08].png:140"
		[/item]
		[item]
			x,y=52,19
			name=flames
			halo="flame-big-A[01~08].png:140"
		[/item]
		[sound]
			name=human-die-1.ogg
		[/sound]
		[sound]
			name=human-die-2.ogg
		[/sound]
		[sound]
			name=human-die-3.ogg
		[/sound]
		[message]
			speaker=Io
			message="No! We arrive too late, the fortress has already fallen!"
		[/message]
	[/event]

	{DROPS 20 0 (bow, staff,sword,axe,polearm) yes 2,3,4}

	{DISABLE_NEGATIVE_INCOME 1}

	{GLOBAL_EVENTS}
[/scenario]