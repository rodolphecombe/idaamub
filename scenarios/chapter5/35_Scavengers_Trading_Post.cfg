#textdomain wesnoth-loi
[scenario]
	id="35_Scavengers_Trading_Post"
	name= _ "Scavenger's Trading Post"
	map_data="{~add-ons/Legends_of_Idaamub/maps/35_Scavengers_Trading_Post.map}"
	victory_when_enemies_defeated=no
	# next_scenario=29_Black_Forest

	{DEFAULT_SCHEDULE}

	[time_area]
		x=3-27
		y=22-28
		{UNDERGROUND}
	[/time_area]

	{PLACE_IMAGE units/gobots/scorcher.png 11 25}
	{PLACE_IMAGE units/gobots/scorcher.png 12 24}
	{PLACE_IMAGE units/gobots/scorcher.png 17 26}
	{PLACE_IMAGE units/gobots/scorcher.png 17 27}

	[event]
		name=prestart
		
		[set_variable]
			name=scenario_number
			value=35
		[/set_variable]

		{VARIABLE drop_chance 20}
		{VARIABLE legionary_talked 0}
		{VARIABLE quest_Oboavlidlu 0}

		[objectives]
			side=1
			[objective]
				[show_if]
					[variable]
						name=legionary_talked
						equals=0
					[/variable]
				[/show_if]
				description= _ "Find out where you are"
				condition=win
			[/objective]
			[objective]
				[show_if]
					[variable]
						name=legionary_talked
						equals=1
					[/variable]
				[/show_if]
				description= _ "Go down the old temple road to Oof foretress."
				condition=win
			[/objective]
			{FOOD_OBJECTIVES}
			[objective]
				description= _ "Death of Io"
				condition=lose
			[/objective]
			{TURNS_RUN_OUT}

			[gold_carryover]
				bonus=yes
				carryover_percentage=100
			[/gold_carryover]
		[/objectives]

		{LOI_RECALL_ALL 6 25}

	[/event]

	[side]
		type="Young Man"
		id=Io
		name= _ "Io"
		x=6
		y=25
		fog=no
		shroud=yes
		side=1
		canrecruit=yes
		profile=portraits/Io.png
		defeat_condition=no_units_left
		controller=human
		team_name=heroes
		user_team_name=_"Heroes"
	[/side]

	[side]
		fog=no
		shroud=no
		side=2
		team_name=wildlife
		user_team_name="Dark Woses"
		recruit=Ancient Dark Wose, EFM_HerbDiseased
		[unit]
			name=_"Gulbomdrumdoom"
			type="Foul Dark Wose"
			canrecruit=yes
			x=33
			y=13
		[/unit]
		income=120
		{GOLD 0 100 3540}
	[/side]

	[side]
		no_leader=yes
		fog=no
		shroud=no
		side=3
		team_name=wildlife
		user_team_name="Wildlife"
		[unit]
			ai_special=guardian
			type="Dread Bat"
			x=25
			y=23
		[/unit]
		[unit]
			ai_special=guardian
			type="Dread Bat"
			x=22
			y=12
		[/unit]
		[unit]
			ai_special=guardian
			type="Dread Bat"
			x=27
			y=28
		[/unit]
		[unit]
			ai_special=guardian
			type="Dread Bat"
			x=31
			y=15
		[/unit]
		[unit]
			ai_special=guardian
			type="Dread Bat"
			x=13
			y=3
		[/unit]
		[unit]
			ai_special=guardian
			type="Dread Bat"
			x=9
			y=9
		[/unit]
		[unit]
			ai_special=guardian
			type="Dread Bat"
			x=10
			y=13
		[/unit]
		[unit]
			ai_special=guardian
			type="Dread Bat"
			x=6
			y=12
		[/unit]
		[unit]
			ai_special=guardian
			type="Dread Bat"
			x=32
			y=5
		[/unit]
		[unit]
			ai_special=guardian
			type="Dread Bat"
			x=34
			y=11
		[/unit]
		[unit]
			ai_special=guardian
			type="Dread Bat"
			x=7
			y=14
		[/unit]
		[unit]
			ai_special=guardian
			type="Dread Bat"
			x=29
			y=21
		[/unit]
		[unit]
			ai_special=guardian
			type="Dread Bat"
			x=32
			y=15
		[/unit]
		[unit]
			ai_special=guardian
			type="Dread Bat"
			x=22
			y=13
		[/unit]
		[unit]
			ai_special=guardian
			type="Dread Bat"
			x=34
			y=26
		[/unit]
		[unit]
			ai_special=guardian
			type="Dread Bat"
			x=23
			y=23
		[/unit]
		[unit]
			ai_special=guardian
			type="Dread Bat"
			x=14
			y=3
		[/unit]
		[unit]
			ai_special=guardian
			type="Dread Bat"
			x=11
			y=12
		[/unit]
		[unit]
			ai_special=guardian
			type="Dread Bat"
			x=30
			y=13
		[/unit]
		[unit]
			ai_special=guardian
			type="Dread Bat"
			x=5
			y=10
		[/unit]
		[unit]
			ai_special=guardian
			type="Dread Bat"
			x=31
			y=21
		[/unit]
		[unit]
			ai_special=guardian
			type="Dread Bat"
			x=8
			y=13
		[/unit]
		[unit]
			ai_special=guardian
			type="Kraken"
			x=29
			y=31
		[/unit]
		[unit]
			ai_special=guardian
			type="Dread Bat"
			x=20
			y=25
		[/unit]
		[unit]
			ai_special=guardian
			type="Dread Bat"
			x=27
			y=8
		[/unit]
		[unit]
			ai_special=guardian
			type="Dread Bat"
			x=38
			y=9
		[/unit]
		[unit]
			ai_special=guardian
			type="Dread Bat"
			x=28
			y=7
		[/unit]
		[unit]
			ai_special=guardian
			type="Dread Bat"
			x=19
			y=21
		[/unit]
		[unit]
			ai_special=guardian
			type="Dread Bat"
			x=22
			y=24
		[/unit]
		[unit]
			ai_special=guardian
			type="Kraken"
			x=22
			y=30
		[/unit]
		[unit]
			ai_special=guardian
			type="Dread Bat"
			x=9
			y=10
		[/unit]
		[unit]
			ai_special=guardian
			type="Dread Bat"
			x=22
			y=23
		[/unit]
		[unit]
			ai_special=guardian
			type="Dread Bat"
			x=28
			y=22
		[/unit]
		[unit]
			ai_special=guardian
			type="Kraken"
			x=15
			y=31
		[/unit]
		[unit]
			ai_special=guardian
			type="Dread Bat"
			x=40
			y=25
		[/unit]
		[unit]
			ai_special=guardian
			type="Dread Bat"
			x=14
			y=6
		[/unit]
		[unit]
			ai_special=guardian
			type="Dread Bat"
			x=19
			y=12
		[/unit]
		[unit]
			ai_special=guardian
			type="Dread Bat"
			x=35
			y=9
		[/unit]
		[unit]
			ai_special=guardian
			type="Dread Bat"
			x=33
			y=17
		[/unit]
		[unit]
			ai_special=guardian
			type="Dread Bat"
			x=33
			y=24
		[/unit]
		[unit]
			ai_special=guardian
			type="Dread Bat"
			x=27
			y=22
		[/unit]
		[unit]
			ai_special=guardian
			type="Dread Bat"
			x=45
			y=20
		[/unit]
		[unit]
			ai_special=guardian
			type="Kraken"
			x=37
			y=30
		[/unit]
		[unit]
			ai_special=guardian
			type="Kraken"
			x=28
			y=31
		[/unit]
		[unit]
			ai_special=guardian
			type="Dread Bat"
			x=8
			y=11
		[/unit]
		[unit]
			ai_special=guardian
			type="Kraken"
			x=30
			y=31
		[/unit]
		[unit]
			ai_special=guardian
			type="Dread Bat"
			x=24
			y=22
		[/unit]
		[unit]
			ai_special=guardian
			type="Dread Bat"
			x=35
			y=15
		[/unit]
		[unit]
			ai_special=guardian
			type="Dread Bat"
			x=28
			y=5
		[/unit]
		[unit]
			ai_special=guardian
			type="Direwolf"
			x=25
			y=20
		[/unit]
		[unit]
			ai_special=guardian
			type="Direwolf"
			x=16
			y=13
		[/unit]
		[unit]
			ai_special=guardian
			type="Direwolf"
			x=42
			y=25
		[/unit]
		[unit]
			ai_special=guardian
			type="Direwolf"
			x=23
			y=27
		[/unit]
		[unit]
			ai_special=guardian
			type="Direwolf"
			x=37
			y=27
		[/unit]
		[unit]
			ai_special=guardian
			type="Direwolf"
			x=39
			y=26
		[/unit]
		[unit]
			ai_special=guardian
			type="Direwolf"
			x=37
			y=11
		[/unit]
		[unit]
			ai_special=guardian
			type="Kraken"
			x=39
			y=31
		[/unit]
		[unit]
			ai_special=guardian
			type="Direwolf"
			x=42
			y=24
		[/unit]
		[unit]
			ai_special=guardian
			type="Direwolf"
			x=22
			y=14
		[/unit]
		[unit]
			ai_special=guardian
			type="Direwolf"
			x=14
			y=9
		[/unit]
		[unit]
			ai_special=guardian
			type="Direwolf"
			x=32
			y=16
		[/unit]
		[unit]
			ai_special=guardian
			type="Direwolf"
			x=43
			y=18
		[/unit]
		[unit]
			ai_special=guardian
			type="Direwolf"
			x=36
			y=27
		[/unit]
		[unit]
			ai_special=guardian
			type="Direwolf"
			x=44
			y=17
		[/unit]
		[unit]
			ai_special=guardian
			type="Direwolf"
			x=27
			y=26
		[/unit]
		[unit]
			ai_special=guardian
			type="Direwolf"
			x=31
			y=10
		[/unit]
		[unit]
			ai_special=guardian
			type="Direwolf"
			x=29
			y=5
		[/unit]
		[unit]
			ai_special=guardian
			type="Direwolf"
			x=38
			y=22
		[/unit]
		[unit]
			ai_special=guardian
			type="Direwolf"
			x=41
			y=26
		[/unit]
		[unit]
			ai_special=guardian
			type="Direwolf"
			x=45
			y=22
		[/unit]
		[unit]
			ai_special=guardian
			type="Direwolf"
			x=37
			y=12
		[/unit]
		[unit]
			ai_special=guardian
			type="Direwolf"
			x=29
			y=7
		[/unit]
		[unit]
			ai_special=guardian
			type="Kraken"
			x=38
			y=31
		[/unit]
		[unit]
			ai_special=guardian
			type="Kraken"
			x=19
			y=32
		[/unit]
		[unit]
			ai_special=guardian
			type="Direwolf"
			x=36
			y=15
		[/unit]
		[unit]
			ai_special=guardian
			type="Direwolf"
			x=26
			y=27
		[/unit]
		[unit]
			ai_special=guardian
			type="Direwolf"
			x=21
			y=9
		[/unit]
		[unit]
			ai_special=guardian
			type="Deshra Juggernaut"
			x=30
			y=12
		[/unit]
		[unit]
			ai_special=guardian
			type="Kraken"
			x=16
			y=31
		[/unit]
		[unit]
			ai_special=guardian
			type="Kraken"
			x=23
			y=31
		[/unit]
		[unit]
			ai_special=guardian
			type="Kraken"
			x=39
			y=30
		[/unit]
		[unit]
			ai_special=guardian
			type="Kraken"
			x=36
			y=30
		[/unit]
		[unit]
			ai_special=guardian
			type="Kraken"
			x=20
			y=30
		[/unit]
		[unit]
			ai_special=guardian
			type="Kraken"
			x=34
			y=31
		[/unit]
		[unit]
			ai_special=guardian
			type="Kraken"
			x=27
			y=31
		[/unit]
		[unit]
			ai_special=guardian
			type="Kraken"
			x=22
			y=31
		[/unit]
	[/side]

	[side]
		no_leader=yes
		fog=no
		shroud=no
		side=4
		team_name=heroes,wildlife
		user_team_name="Humans"
		[unit]
			id=Durissa
			ai_special=guardian
			name=_"Durissa"
			type="Pikeman"
			x=20
			y=24
		[/unit]
		[unit]
			id=Alealyan
			ai_special=guardian
			name=_"Alealyan"
			type="Swordsman"
			x=21
			y=24
		[/unit]
		[unit]
			ai_special=guardian
			id=trader
			name=_"Oddaty, the Scavenger"
			type="Rogue"
			x=26
			y=10
		[/unit]
		[unit]
			ai_special=guardian
			id=Oboavlidlu
			name=_"Oboavlidlu"
			type="Trapper"
			x=33
			y=8
		[/unit]
	[/side]

	[event]
		name=prestart

		#ifdef EASY
		[terrain]
			x=32,34
			y=13,13
			terrain=Gll^Fms
		[/terrain]
		#endif

		#ifndef NORMAL
		[terrain]
			x=6,6
			y=24,26
			terrain=Ket
		[/terrain]
		[terrain]
			x=33
			y=14
			terrain=Cvr^Fms
		[/terrain]
		#endif

		#ifdef HARD
		[terrain]
			x=5,5,7,7
			y=25,26,25,26
			terrain=Icn
		[/terrain]
		#endif
	[/event]

	[event]
		name=start
		[remove_shroud]
			x=4-17
			y=23-27
		[/remove_shroud]
		[message]
			speaker=Io
			message="The elevator lead us here. I have no idea were we are. I hope we are no too far from an exit."
		[/message]
		[message]
			speaker=Io
			message="It looks like there are some machines further, but they don't seem to move. They probably got disabled with the rest of the complex."
		[/message]
		[if]
			[have_unit]
				id=Amin
			[/have_unit]
			[then]
				[message]
					speaker=Amin
					message="I gonna smash them."
				[/message]
				{MOVE_UNIT id=Amin 10 25}
                [redraw]
                [/redraw]
				[animate_unit]
					[filter]
						id=Amin
					[/filter]
					flag=attack
					[primary_attack]
						name=hammer
					[/primary_attack]
					hits=yes
				[/animate_unit]
				[remove_item]
                    x,y=11,25
                [/remove_item]
                {MOVE_UNIT id=Amin 11 25}
                [redraw]
                [/redraw]
				[animate_unit]
					[filter]
						id=Amin
					[/filter]
					flag=attack
					[primary_attack]
						name=hammer
					[/primary_attack]
					hits=yes
				[/animate_unit]
				[remove_item]
                    x,y=12,24
                [/remove_item]
                {MOVE_UNIT id=Amin 16 26}
                [redraw]
                [/redraw]
				[animate_unit]
					[filter]
						id=Amin
					[/filter]
					flag=attack
					[primary_attack]
						name=hammer
					[/primary_attack]
					hits=yes
				[/animate_unit]
				[remove_item]
                    x,y=17,26
                [/remove_item]
                [animate_unit]
					[filter]
						id=Amin
					[/filter]
					flag=attack
					[primary_attack]
						name=hammer
					[/primary_attack]
					hits=yes
				[/animate_unit]
				[remove_item]
                    x,y=17,27
                [/remove_item]
                [message]
                	speaker=Amin
                	message="There seem to be a lever there. I gonna pull it."
                [/message]
                {MOVE_UNIT id=Amin 17 27}
                [terrain]
                	x=18,18
                	y=25,27
                	terrain=Mm^Xm
                [/terrain]
                [terrain]
                	x=18
                	y=26
                	terrain=Re
                [/terrain]
                [message]
                	speaker=Amin
                	message="A huge rock slid and opened a hole in the wall. It seems I found the exit."
                [/message]
			[/then]
		[/if]
	[/event]

	[event]
		name=moveto
		x,y=17,27
		[if]
			[have_unit]
				id=Amin
			[/have_unit]
			[else]
				[message]
					speaker=unit
					message="There is a lever on the wall."
				[/message]
				[message]
					speaker=Io
					message="Pull it please."
				[/message]
				[terrain]
                	x=18,18
                	y=25,27
                	terrain=Mm^Xm
                [/terrain]
                [terrain]
                	x=18
                	y=26
                	terrain=Re
                [/terrain]
                [message]
                	speaker=unit
                	message="A huge rock slid and opened a hole in the wall."
                [/message]
                [message]
					speaker=Io
					message="It seems we found the exit."
				[/message]
				[if]
					[have_unit]
						side=1
						id=Teumiuxe
					[/have_unit]
					[then]
						[message]
							speaker=Teumiuxe
							message="Wait, those are legionaries. Let me talk to them."
						[/message]
					[/then]
				[/if]
			[/else]
		[/if]
	[/event]

	[event]
		name=moveto
		[filter]
			side=1
			[filter_adjacent]
				id=Durissa
			[/filter_adjacent]
		[/filter]
		[if]
			[have_unit]
				side=1
				id=Teumiuxe
			[/have_unit]
			[then]
				[message]
					speaker=Teumiuxe
					message="Legionary, report!"
				[/message]
				[message]
					speaker=Durissa
					message=_"The Great Mage!"
				[/message]
				[message]
					speaker=Durissa
					message=_"By Of’s shield, is the Guardian sending you?"
				[/message]
				[message]
					speaker=Teumiuxe
					message="Actually, we are on a mission for the kingdom, but we might be of mutual help."
				[/message]
				[message]
					speaker=Teumiuxe
					message="Tell me, where are we and what are you doing here?"
				[/message]
				[message]
					speaker=Durissa
					message=_"Unfortunately, we are in the middle of nowhere. Our detachment left Oof fortress to try to get emergency reinforcement from Udxatfe."
				[/message]
				[message]
					speaker=Durissa
					message=_"Four days ago, a necromancer with terrible powers by the name of Isut appeared and fell onto us, flanked by undead and Dunefolk. The Dunefolk outnumbering us, they blocked access to Idaamub’s castle from the east and we got blocked from both sides."
				[/message]
				[message]
					speaker=Teumiuxe
					message="That is terrible news."
				[/message]
				[message]
					speaker=Durissa
					message=_"The six of us left by the old temple road to dodge Isut, but we fell onto one of his tentacle guardians, which did not spare us. We both took refuge here, but it is impossible to bring reinforcement from the legion to captain Soimaql on time."
				[/message]
				[message]
					speaker=Teumiuxe
					message="We might be able to do something about that."
				[/message]
				[message]
					speaker=Durissa
					message=_"I know who you are, I think you should be a match for Isut. You could give my comrades the boost they need to stop this monster before he kills us all."
				[/message]
				[message]
					speaker=Teumiuxe
					message="Our course of action is clear."
				[/message]
				[message]
					speaker=Teumiuxe
					message="We need to go down the old temple road to reach Oof's fortress and free it from Isut."
				[/message]
				[message]
					speaker=Teumiuxe
					message="We will then join Idaamub's castle to help break the Dunefolk siege."
				[/message]
				[message]
					speaker=Teumiuxe
					message="Once it is done, we will be able to deliver our message to the king."
				[/message]
				[message]
					speaker=Teumiuxe
					message="Stay here to heal your wounds. You will be of no help like that."
				[/message]
				[message]
					speaker=Durissa
					message=_"Sir, yes, Sir!"
				[/message]
			[/then]
			[else]
				[message]
					speaker=unit
					message="Excuse me, sir."
				[/message]
				[message]
					speaker=Durissa
					message=_"By Of’s shield, is the Guardian sending you?"
				[/message]
				[message]
					speaker=Io
					message="Actually, we are on a mission for the kingdom, but we might be of mutual help."
				[/message]
				[message]
					speaker=Io
					message="Tell me, where are we and what are you doing here?"
				[/message]
				[message]
					speaker=Durissa
					message=_"Unfortunately, we are in the middle of nowhere. Our detachment left Oof fortress to try to get emergency reinforcement from Udxatfe."
				[/message]
				[message]
					speaker=Durissa
					message=_"Four days ago, a necromancer with terrible powers by the name of Isut appeared and fell onto us, flanked by undead and Dunefolk. The Dunefolk outnumbering us, they blocked access to Idaamub’s castle from the east and we got blocked from both sides."
				[/message]
				[message]
					id="Csia","Io"
					message="That is terrible news."
				[/message]
				[message]
					speaker=Durissa
					message=_"The six of us left by the old temple road to dodge Isut, but we fell onto one of his tentacle guardians, which did not spare us. We both took refuge here, but it is impossible to bring reinforcement from the legion to captain Soimaql on time."
				[/message]
				[message]
					id="Csia","Io"
					message="We might be able to do something about that."
				[/message]
				[message]
					speaker=Durissa
					message=_"I don’t know who you are, but if you’re as competent as you look like, I think you should be a match for Isut. You could give my comrades the boost they need to stop this monster before he kills us all."
				[/message]
				[message]
					id="Csia","Io"
					message="Our course of action is clear."
				[/message]
				[message]
					id="Csia","Io"
					message="We need to go down the old temple road to reach Oof's fortress and free it from Isut."
				[/message]
				[message]
					id="Csia","Io"
					message="We will then join Idaamub's castle to help break the Dunefolk siege."
				[/message]
				[message]
					id="Csia","Io"
					message="Once it is done, we will be able to deliver our message to the king."
				[/message]
				[message]
					id="Csia","Io"
					message="Stay here to heal your wounds. You will be of no help like that."
				[/message]
			[/else]
		[/if]
		{VARIABLE legionary_talked 1}
		[show_objectives]
		[/show_objectives]
	[/event]

	[event]
		name=moveto
		[filter]
			side=1
			[filter_adjacent]
				id=Alealyan
			[/filter_adjacent]
		[/filter]
		[message]
			speaker=unit
			message="Are you alright?"
		[/message]
		[message]
			speaker=Alealyan
			message="Those tentacles, those teeth… those flickering lights… and all those dead… why so many dead?"
		[/message]
		[message]
			speaker=unit
			message="Looks like he lost his mind."
		[/message]
	[/event]

	[event]
		name=moveto
		[filter]
			side=1
			[filter_adjacent]
				id=Oboavlidlu
			[/filter_adjacent]
		[/filter]
		[message]
			speaker=Oboavlidlu
			message="Mylord Oddaty and I supplied a group of treasure hunters that were examining the flooded tunnels west. Maybe you are also going in that direction?"
		[/message]
		[message]
			speaker=Io
			message="I'm sorry but we aren't."
		[/message]
		[message]
			speaker=Oboavlidlu
			message="They have not come for several days. They never talked about leaving."
		[/message]
		[message]
			speaker=Oboavlidlu
			message="It is always displeasing to lose regular customers, especially when you do not know where they went. If by chance you meet them, tell them we appreciate doing business with them."
		[/message]
		[message]
			speaker=Io
			message="Well, if we happen to meet them, we will tell them you are looking forward seeing them again."
		[/message]
		[message]
			speaker=Oboavlidlu
			message="And if it happens that they… hmm… closed their account, come back to tell us where they are."
		[/message]
		[message]
			speaker=Io
			message="I am sorry, but, even if we were to visit those tunnels, I do not think we would have the time to come back to you."
		[/message]
		[message]
			speaker=Oboavlidlu
			message="You would not regret it, I promise. In these difficult times, it would be regrettable to lose their… support."
		[/message]
		[message]
			speaker=Oboavlidlu
			message="Were I to learn that you go into the tunnels, I would wait for you at their entrance; that way you will not have to come back here."
		[/message]
		{VARIABLE quest_Oboavlidlu 1}
	[/event]

	[event]
		name=moveto
		first_time_only=yes
		[filter]
			side=1
			[filter_adjacent]
				id=trader
			[/filter_adjacent]
		[/filter]
		[message]
			speaker=trader
			message="Come in, come in! Hmm… you do not seem move in the best circles, but one should never under-estimate the lower classes…"
		[/message]
		[message]
			speaker=trader
			message="My assistant and I have found these items on a group of mages on the temple road. Some of these items might interest you, but we have not yet got them rid of their… unpleasant smell."
		[/message]
		[message]
			speaker=trader
			message="But it should not disturb someone like you, should it?"
		[/message]
	[/event]

    [event]
		name=moveto
		first_time_only=no
		[filter]
			side=1
			[filter_location]
				x=15
				y=11
				radius=1
			[/filter_location]
		[/filter]
		[store_gold]
			side=1
			variable=gold
		[/store_gold]
		{VARIABLE is_on_shop yes}
		[set_variable]
			name=x1
			value=$unit.x
		[/set_variable]
		[set_variable]
			name=y1
			value=$unit.y
		[/set_variable]
		[fire_event]
			name=Meixmi_shop
			[primary_unit]
				x,y=$x1,$y1
			[/primary_unit]
		[/fire_event]
	[/event]

	[event]
		name=Meixmi_shop
		first_time_only=no
		[message]
			speaker=trader
			message="What can Oddaty the Scavenger do for you today?"
			[option]
				message="Buy weapons"
				[command]
					[fire_event]
						name=buy_weapons
						[primary_unit]
							x,y=$x1,$y1
						[/primary_unit]
					[/fire_event]
				[/command]
			[/option]
			[option]
				message="Buy armours"
				[command]
					[fire_event]
						name=buy_armours
						[primary_unit]
							x,y=$x1,$y1
						[/primary_unit]
					[/fire_event]
				[/command]
			[/option]
			[option]
				message="Buy books"
				[command]
					[fire_event]
						name=buy_books
						[primary_unit]
							x,y=$x1,$y1
						[/primary_unit]
					[/fire_event]
				[/command]
			[/option]
			[option]
				message="Buy potions"
				[command]
					[fire_event]
						name=buy_potions
						[primary_unit]
							x,y=$x1,$y1
						[/primary_unit]
					[/fire_event]
				[/command]
			[/option]
			[option]
				message="Buy food"
				[command]
					[fire_event]
						name=buy_food
						[primary_unit]
							x,y=$x1,$y1
						[/primary_unit]
					[/fire_event]
				[/command]
			[/option]
			[option]
				message="Sell"
				[command]
					[message]
						speaker=trader
						message= _ "To sell an object, select ``Sell'' in the item storage."
					[/message]
				[/command]
			[/option]
			[option]
				message="Leave"
				[command]
					{CLEAR_VARIABLE gold}
				[/command]
			[/option]
		[/message]
	[/event]

	[event]
		name=buy_weapons
		first_time_only=no
		[message]
			speaker=trader
			message= _ "What kind of weapon do you want to buy?"
			[option]
				message="Staffs"
				[command]
					[fire_event]
						name=buy_staffs
						[primary_unit]
							x,y=$x1,$y1
						[/primary_unit]
					[/fire_event]
				[/command]
			[/option]
			[option]
				message="Bows"
				[command]
					[fire_event]
						name=buy_bows
						[primary_unit]
							x,y=$x1,$y1
						[/primary_unit]
					[/fire_event]
				[/command]
			[/option]
			[option]
				message="Swords"
				[command]
					[fire_event]
						name=buy_swords
						[primary_unit]
							x,y=$x1,$y1
						[/primary_unit]
					[/fire_event]
				[/command]
			[/option]
			[option]
				message="Crossbows"
				[command]
					[fire_event]
						name=buy_crossbows
						[primary_unit]
							x,y=$x1,$y1
						[/primary_unit]
					[/fire_event]
				[/command]
			[/option]
			[option]
				message="Maces"
				[command]
					[fire_event]
						name=buy_maces
						[primary_unit]
							x,y=$x1,$y1
						[/primary_unit]
					[/fire_event]
				[/command]
			[/option]
			[option]
				message="Axes"
				[command]
					[fire_event]
						name=buy_axes
						[primary_unit]
							x,y=$x1,$y1
						[/primary_unit]
					[/fire_event]
				[/command]
			[/option]
			[option]
				message="Back"
				[command]
					[fire_event]
						name=Meixmi_shop
						[primary_unit]
							x,y=$x1,$y1
						[/primary_unit]
					[/fire_event]
				[/command]
			[/option]
		[/message]
	[/event]

	[event]
		name=buy_armours
		first_time_only=no
		[message]
			speaker=trader
			message= _ "What kind of weapon do you want to buy?"
			[option]
				message="Gloves"
				[command]
					[fire_event]
						name=buy_gloves
						[primary_unit]
							x,y=$x1,$y1
						[/primary_unit]
					[/fire_event]
				[/command]
			[/option]
			[option]
				message="Boots"
				[command]
					[fire_event]
						name=buy_boots
						[primary_unit]
							x,y=$x1,$y1
						[/primary_unit]
					[/fire_event]
				[/command]
			[/option]
			[option]
				message="Helms"
				[command]
					[fire_event]
						name=buy_helms
						[primary_unit]
							x,y=$x1,$y1
						[/primary_unit]
					[/fire_event]
				[/command]
			[/option]
			[option]
				message="Armours"
				[command]
					[fire_event]
						name=buy_armours_2
						[primary_unit]
							x,y=$x1,$y1
						[/primary_unit]
					[/fire_event]
				[/command]
			[/option]
			[option]
				message="Shields"
				[command]
					[fire_event]
						name=buy_shields
						[primary_unit]
							x,y=$x1,$y1
						[/primary_unit]
					[/fire_event]
				[/command]
			[/option]
			[option]
				message="Back"
				[command]
					[fire_event]
						name=Meixmi_shop
						[primary_unit]
							x,y=$x1,$y1
						[/primary_unit]
					[/fire_event]
				[/command]
			[/option]
		[/message]
	[/event]

	[event]
		name=buy_staffs
		first_time_only=no
		[message]
			speaker=trader
			message= _ "What kind of staff do you want to buy?"
			{SHOP_ITEM _"Avenging blade-staff of revival" 29373 729 items/spear-fancy-2.png i1}
			{SHOP_ITEM _"Staff of awareness" 11049 730 items/staff.png i2}
			{SHOP_ITEM _"Avenging staff of focus" 8028 731 items/staff.png i3}
			{SHOP_ITEM _"Avenging thorny blade-staff" 7698 732 items/spear-fancy-2.png i4}
			[option]
				message="Back"
				[command]
					[fire_event]
						name=buy_weapons
						[primary_unit]
							x,y=$x1,$y1
						[/primary_unit]
					[/fire_event]
				[/command]
			[/option]
		[/message]
	[/event]

	[event]
		name=buy_bows
		first_time_only=no
		[message]
			speaker=trader
			message= _ "What kind of bow do you want to buy?"
			{SHOP_ITEM _"Avenging long reinforced bow of the fox" 22653 738 items/bow.png i6}
			{SHOP_ITEM _"Avenging war bow of massacre" 21072 739 items/bow.png i7}
			{SHOP_ITEM _"Long reinforced slippery bow of revival" 20751 740 items/bow.png i8}
			{SHOP_ITEM _"Long reinforced slippery bow of midnight" 18768 741 items/bow.png i9}
			{SHOP_ITEM _"Slippery war bow of disease" 16221 742 items/bow.png i10}
			[option]
				message="Back"
				[command]
					[fire_event]
						name=buy_weapons
						[primary_unit]
							x,y=$x1,$y1
						[/primary_unit]
					[/fire_event]
				[/command]
			[/option]
		[/message]
	[/event]

	[event]
		name=buy_swords
		first_time_only=no
		[message]
			speaker=trader
			message= _ "What kind of sword do you want to buy?"
			{SHOP_ITEM _"Avenging longsword of vivacity" 49935 721 items/sword.png i11}
			{SHOP_ITEM _"Ripper longsword of vivacity" 34515 722 items/sword.png i12}
			{SHOP_ITEM _"Avenging steel thorny sword" 22929 723 items/sword.png i13}
			{SHOP_ITEM _"Longsword of awareness" 11862 724 items/sword.png i14}
			[option]
				message="Back"
				[command]
					[fire_event]
						name=buy_weapons
						[primary_unit]
							x,y=$x1,$y1
						[/primary_unit]
					[/fire_event]
				[/command]
			[/option]
		[/message]
	[/event]

	[event]
		name=buy_crossbows
		first_time_only=no
		[message]
			speaker=trader
			message= _ "What kind of crossbow do you want to buy?"
			{SHOP_ITEM _"Long slippery crossbow of haste" 42756 725 items/crossbow-huge.png i16}
			{SHOP_ITEM _"Long slippery crossbow of increase" 24192 726 items/crossbow-huge.png i17}
			{SHOP_ITEM _"Long slippery crossbow of revival" 16881 727 items/crossbow-huge.png i18}
			{SHOP_ITEM _"Long slippery crossbow" 16827 614 items/crossbow.png i19}
			{SHOP_ITEM _"Long crossbow of the fox" 16827 728 items/crossbow.png i20}
			[option]
				message="Back"
				[command]
					[fire_event]
						name=buy_weapons
						[primary_unit]
							x,y=$x1,$y1
						[/primary_unit]
					[/fire_event]
				[/command]
			[/option]
		[/message]
	[/event]

	[event]
		name=buy_maces
		first_time_only=no
		[message]
			speaker=trader
			message= _ "What kind of mace do you want to buy?"
			{SHOP_ITEM _"Ripper hammer of monstrosity" 33783 733 items/hammer.png i21}
			{SHOP_ITEM _"Ripper spike mace of monstrosity" 30195 734 items/mace.png i22}
			{SHOP_ITEM _"Riper mallet of revival" 25794 735 items/hammer.png i23}
			{SHOP_ITEM _"Riper symptomatic mallet" 13431 736 items/hammer.png i24}
			{SHOP_ITEM _"Avenging burning winged mace" 737 8964 items/mace.png i25}
			[option]
				message="Back"
				[command]
					[fire_event]
						name=buy_weapons
						[primary_unit]
							x,y=$x1,$y1
						[/primary_unit]
					[/fire_event]
				[/command]
			[/option]
		[/message]
	[/event]

	[event]
		name=buy_axes
		first_time_only=no
		[message]
			speaker=trader
			message= _ "What kind of axe do you want to buy?"
			{SHOP_ITEM _"Assault ripper axe of vivacity" 13236 743 items/axe.png i26}
			{SHOP_ITEM _"Combat ripper axe of midnight" 9702 744 items/axe.png i27}
			{SHOP_ITEM _"Assault shocking axe" 6153 745 items/axe.png i28}
			{SHOP_ITEM _"Burning straight axe" 5712 746 items/axe.png i29}
			{SHOP_ITEM _"Damaged assault axe" 3735 747 items/axe.png i30}
			[option]
				message="Back"
				[command]
					[fire_event]
						name=buy_weapons
						[primary_unit]
							x,y=$x1,$y1
						[/primary_unit]
					[/fire_event]
				[/command]
			[/option]
		[/message]
	[/event]

	[event]
		name=buy_gloves
		first_time_only=no
		[message]
			speaker=trader
			message= _ "What kind of gloves do you want to buy?"
			{SHOP_ITEM _"Mail gloves of inversion" 31029 718 items/gauntlets.png i31}
			{SHOP_ITEM _"Rough mail gloves of the fox" 18861 533 items/gauntlets.png i32}
			{SHOP_ITEM _"Slippery mail gloves of vivacity" 18861 719 items/gauntlets.png i33}
			{SHOP_ITEM _"Mail gloves of vivacity" 16260 575 items/gauntlets.png i34}
			{SHOP_ITEM _"Banded gauntlets" 13917 720 items/gauntlets.png i35}
			[option]
				message="Back"
				[command]
					[fire_event]
						name=buy_armours
						[primary_unit]
							x,y=$x1,$y1
						[/primary_unit]
					[/fire_event]
				[/command]
			[/option]
		[/message]
	[/event]

	[event]
		name=buy_boots
		first_time_only=no
		[message]
			speaker=trader
			message= _ "What kind of boots do you want to buy?"
			{SHOP_ITEM _"Slippery mail boots" 43887 709 items/boots.png i36}
			{SHOP_ITEM _"Organic mail boots" 35925 710 items/boots.png i37}
			{SHOP_ITEM _"Mail boots of awareness" 28965 711 items/boots.png i38}
			{SHOP_ITEM _"Ripper mail boots of the fox" 23130 712 items/boots.png i39}
			{SHOP_ITEM _"Rough mail boots" 22956 675 items/boots.png i40}
			[option]
				message="Back"
				[command]
					[fire_event]
						name=buy_armours
						[primary_unit]
							x,y=$x1,$y1
						[/primary_unit]
					[/fire_event]
				[/command]
			[/option]
		[/message]
	[/event]

	[event]
		name=buy_helms
		first_time_only=no
		[message]
			speaker=trader
			message= _ "What kind of helm do you want to buy?"
			{SHOP_ITEM _"Rough desert helm of the fox" 32547 713 items/helmet.png i41}
			{SHOP_ITEM _"Rough winged helm" 21624 714 items/helmet.png i42}
			{SHOP_ITEM _"Desert helm" 19254 715 items/helmet.png i43}
			{SHOP_ITEM _"Organic panache helm" 13725 716 items/helmet.png i44}
			{SHOP_ITEM _"Onyx helm of the fox" 10674 717 items/helmet.png i45}
			[option]
				message="Back"
				[command]
					[fire_event]
						name=buy_armours
						[primary_unit]
							x,y=$x1,$y1
						[/primary_unit]
					[/fire_event]
				[/command]
			[/option]
		[/message]
	[/event]

	[event]
		name=buy_armours_2
		first_time_only=no
		[message]
			speaker=trader
			message= _ "What kind of armour do you want to buy?"
			{SHOP_ITEM _"Basic war plate armor" 221674 704 items/armor.png i46}
			{SHOP_ITEM _"Heavy rough plate armor" 144741 705 items/armor.png i47}
			{SHOP_ITEM _"Rough thin chainmail" 129315 706 items/armour.png i48}
			{SHOP_ITEM _"Heavy plate armor of the fox" 100797 707 items/armor.png i49}
			{SHOP_ITEM _"Severe coat of privilege" 95778 708 items/armour-leather.png i50}
			[option]
				message="Back"
				[command]
					[fire_event]
						name=buy_armours
						[primary_unit]
							x,y=$x1,$y1
						[/primary_unit]
					[/fire_event]
				[/command]
			[/option]
		[/message]
	[/event]

	[event]
		name=buy_shields
		first_time_only=no
		[message]
			speaker=trader
			message= _ "What kind of shield do you want to buy?"
			{SHOP_ITEM _"Great rough pavise of the fox" 51936 748 items/buckler.png i51}
			{SHOP_ITEM _"Massive great pavise of the fox" 45708 749 items/buckler.png i52}
			{SHOP_ITEM _"Great slippery pavise of the fox" 42801 750 items/buckler.png i53}
			{SHOP_ITEM _"Great pavise" 27828 751 items/buckler.png i54}
			{SHOP_ITEM _"Blocking pavise of the fox" 22551 752 items/buckler.png i55}
			[option]
				message="Back"
				[command]
					[fire_event]
						name=buy_armours
						[primary_unit]
							x,y=$x1,$y1
						[/primary_unit]
					[/fire_event]
				[/command]
			[/option]
		[/message]
	[/event]

	[event]
		name=buy_books
		first_time_only=no
		[message]
			speaker=trader
			message= _ "What kind of book do you want to buy?"
			{SHOP_ITEM _"To get close" 103659 753 items/book2.png i56}
			{SHOP_ITEM _"Brother bear" 59727 754 items/book4.png i57}
			{SHOP_ITEM _"Fire shield" 41838 755 items/book5.png i58}
			{SHOP_ITEM _"The Ring" 24123 756 items/book1.png i59}
			{SHOP_ITEM _"Rage" 66 129 items/book3.png i60}
			[option]
				message="Back"
				[command]
					[fire_event]
						name=Meixmi_shop
						[primary_unit]
							x,y=$x1,$y1
						[/primary_unit]
					[/fire_event]
				[/command]
			[/option]
		[/message]
	[/event]

	[event]
		name=buy_potions
		first_time_only=no
		[message]
			speaker=trader
			message= _ "What kind of potion do you want to buy?"
			{SHOP_ITEM _"Great potion of rejuvenation" 540 623 items/potion-grey.png i61}
			{SHOP_ITEM _"Great experience potion" 420 624 items/potion-blue.png i62}
			{SHOP_ITEM _"Great Healing Potion" 360 669 items/potion-red.png i63}
			{SHOP_ITEM _"Experience potion" 105 177 items/potion-blue.png i64}
             {SHOP_ITEM _"Small potion of rejuvenation" 60 236 items/potion-grey.png i65}
			[option]
				message="Back"
				[command]
					[fire_event]
						name=Meixmi_shop
						[primary_unit]
							x,y=$x1,$y1
						[/primary_unit]
					[/fire_event]
				[/command]
			[/option]
		[/message]
	[/event]

	[event]
		name=buy_food
		first_time_only=no
		#ifndef EASY
		[if]
			[have_unit]
				side=1
				type=Bay Horse, Great Horse
			[/have_unit]
			[then]
		#endif
				[message]
					speaker=trader
					message= _ "How much food do you need?"
					[option]
						message="Buy 1 food for $food_price| gold"
						[command]
							[if]
								[variable]
									name=gold
									greater_than_equal_to=$food_price
								[/variable]
								[else]
									[message]
										speaker=trader
										message= _ "You don't have enough money."
									[/message]
								[/else]
								[then]
									[gold]
										side=1
										amount=-$food_price
									[/gold]
									{VARIABLE_OP food_counter add 1}
									[message]
										speaker=Io
										message="We now have $food_counter| food."
									[/message]
									[command]
										[fire_event]
											name=buy_food
											[primary_unit]
												x,y=$x1,$y1
											[/primary_unit]
										[/fire_event]
									[/command]
								[/then]
							[/if]
						[/command]
					[/option]
					[option]
						message="Buy 5 food for $(5*$food_price) gold"
						[command]
							[if]
								[variable]
									name=gold
									greater_than_equal_to="$(5*$food_price)"
								[/variable]
								[else]
									[message]
										speaker=trader
										message= _ "You don't have enough money."
									[/message]
								[/else]
								[then]
									[gold]
										side=1
										amount="$(-5*$food_price)"
									[/gold]
									{VARIABLE_OP food_counter add 5}
									[message]
										speaker=Io
										message="We now have $food_counter| food."
									[/message]
									[command]
										[fire_event]
											name=buy_food
											[primary_unit]
												x,y=$x1,$y1
											[/primary_unit]
										[/fire_event]
									[/command]
								[/then]
							[/if]
						[/command]
					[/option]
					[option]
						message="Buy 10 food for $(10*$food_price) gold"
						[command]
							[if]
								[variable]
									name=gold
									greater_than_equal_to="$(10*$food_price)"
								[/variable]
								[else]
									[message]
										speaker=trader
										message= _ "You don't have enough money."
									[/message]
								[/else]
								[then]
									[gold]
										side=1
										amount="$(-10*$food_price)"
									[/gold]
									{VARIABLE_OP food_counter add 10}
									[message]
										speaker=Io
										message="We now have $food_counter| food."
									[/message]
									[command]
										[fire_event]
											name=buy_food
											[primary_unit]
												x,y=$x1,$y1
											[/primary_unit]
										[/fire_event]
									[/command]
								[/then]
							[/if]
						[/command]
					[/option]
					[option]
						message="Back"
						[command]
							[fire_event]
								name=Meixmi_shop
								[primary_unit]
									x,y=$x1,$y1
								[/primary_unit]
							[/fire_event]
						[/command]
					[/option]
				[/message]
	#ifndef EASY
			[/then]
			[else]
				[message]
					speaker=trader
					message="Do you have something to transport it?"
				[/message]
				[message]
					speaker=Io
					message="Unfortunately not."
				[/message]
				[message]
					speaker=trader
					message="Come back when you do then."
				[/message]
			[/else]
		[/if]
	#endif
	[/event]
	
	[event]
		name=exit_hex
		first_time_only=no
		[filter]
			side=1
			[filter_location]
				x=15
				y=11
				radius=1
			[/filter_location]
		[/filter]
		{VARIABLE is_on_shop no}
	[/event]

	[event]
		name=sighted,attack
		[filter]
			type=Ancient Dark Wose, Diseased Herb Spirit
		[/filter]
		[filter_second]
			side=1
		[/filter_second]
		[message]
			speaker=second_unit
			message="The tree. It's attacking me."
		[/message]
		[message]
			{MAGE_FILTER}
			message="It looks like it has been corrupted, like the ones we encountered in the swamp. But this time, the corruption feels... natural."
		[/message]
		[message]
			{MAGE_FILTER}
			message="There must be some kind of mad wose in this forest corrupting neighboring trees."
		[/message]
	[/event]

	[event]
		name=die
		[filter]
			type=Foul Dark Wose
			canrecruit=yes
		[/filter]
		[message]
			speaker=second_unit
			message="It looks like that tree was completely rotten."
		[/message]
		[message]
			{MAGE_FILTER}
			message="It must have been the mad wose that corrupted all the other trees. The forest should be more peaceful now."
		[/message]
		[message]
			{MAGE_FILTER}
			message="Well, I mean, apart from the rest of the wildlife trying to kill us."
		[/message]
	[/event]

	[event]
		name=moveto
		[filter]
			side=1
			x=15
			y=11
		[/filter]
		[message]
			speaker=unit
			message="There was a cyclops in the house."
		[/message]
		[unit]
			type="Deshra Juggernaut"
			x=15
			y=11
		[/unit]
	[/event]

	[event]
		name=moveto
		first_time_only=no
		[filter]
			side=1
			x=6,15
			y=9,11
		[/filter]
		[message]
			speaker=unit
			message="There are stairs going down into a tunnel."
		[/message]
		[if]
			[variable]
				name=quest_Oboavlidlu
				equals=1
			[/variable]
			[then]
				[message]
					speaker=Io
					message="It must be the flooded tunnels Oboavlidlu told us about."
				[/message]
				[message]
					speaker=unit
					message="Should we go down there?"
					[option]
						message="Yes, we should try to find the treasure hunters. Who knows what happened to them?"
						[command]
							[if]
								[variable]
									name=x1
									equals=6
								[/variable]
								[then]
									{VARIABLE entrance 1}
								[/then]
								[else]
									{VARIABLE entrance 2}
								[/else]
							[/if]
							[store_side]
								side=1
								variable=stored_side
							[/store_side]
							{END_FOOD}
							[endlevel]
								result=victory
								bonus=no
								next_scenario=35b_Flooded_Tunnels
								{NEW_GOLD_CARRYOVER 100}
							[/endlevel]
						[/command]
					[/option]
					[option]
						message="No, we have no time for that. We need to go down the old temple road."
						[command]
						[/command]
					[/option]
				[/message]
			[/then]
			[else]
				[message]
					speaker=unit
					message="Should we go down there?"
					[option]
						message="Yes, let's see where it leads."
						[command]
							[if]
								[variable]
									name=x1
									equals=6
								[/variable]
								[then]
									{VARIABLE entrance 1}
								[/then]
								[else]
									{VARIABLE entrance 2}
								[/else]
							[/if]
							[store_side]
								side=1
								variable=stored_side
							[/store_side]
							{END_FOOD}
							[endlevel]
								result=victory
								bonus=no
								next_scenario=35b_Flooded_Tunnels
								{NEW_GOLD_CARRYOVER 100}
							[/endlevel]
						[/command]
					[/option]
					[option]
						message="No, we have no time for that. We need to go down the old temple road."
						[command]
						[/command]
					[/option]
				[/message]
			[/else]
		[/if]
	[/event]

	[event]
		name=moveto
		first_time_only=no
		[filter]
			side=1
			x,y=13,1
		[/filter]
		[message]
			speaker=Io
			message="Let's continue. We need to reach Oof fortress as quickly as possible."
		[/message]
		{END_FOOD}
		[endlevel]
			bonus=yes
			result=victory
			{NEW_GOLD_CARRYOVER 100}
		[/endlevel]
	[/event]

	[event]
		name=side 1 turn 25
		[message]
			speaker=Io
			message="How many walking trees are there in this forest?!"
		[/message]
		[role]
			side=1
			{MAGE_FILTER}
			role=mage
		[/role]
		[message]
			role=mage
			message="There are a lot of trees, but not all of them are wose."
		[/message]
		[message]
			role=mage
			message="On the plus side, as you have seen, the wose are quite slow, so we just need to progress faster than they are coming for us."
		[/message]
		[message]
			role=mage
			message="Even better, if we could get rid of the wose that is spreading the corruption to the forest, the trees should then leave us in peace."
		[/message]
	[/event]

	[event]
		name=turn 100
		{VARIABLE drop_chance 0}
	[/event]

	[event]
		name=victory
		{CLEAR_VARIABLE drop_chance}
		{CLEAR_VARIABLE legionary_talked}
	[/event]

	{DROPS $drop_chance| 0 (bow, mace, staff, polearm, axe) yes 2,3}

	{DISABLE_NEGATIVE_INCOME 1}

	{GLOBAL_EVENTS}

[/scenario]


