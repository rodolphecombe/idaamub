#textdomain wesnoth-loi
[scenario]
	id="26b_Troll_Fort"
	name= _ "Troll Fort"
	map_data="{~add-ons/Legends_of_Idaamub/maps/26b_Troll_Fort.map}"
	victory_when_enemies_defeated=no

	#next_scenario=28

	{UNDERGROUND}

	{PLACE_IMAGE items/chest.png 4 3}
	{PLACE_IMAGE items/chest.png 8 3}
	{PLACE_IMAGE items/chest.png 7 5}

	[event]
		name=prestart

		{VARIABLE plate1 0}
		{VARIABLE plate2 0}
		{VARIABLE plate3 0}
		{VARIABLE plate4 0}
		{VARIABLE plate5 0}
		{VARIABLE plate6 0}
		{VARIABLE plate7 0}
		{VARIABLE plate8 0}
		{VARIABLE lever1 0}
		{VARIABLE lever2 0}
		{VARIABLE lever3 0}
		{VARIABLE lever4 0}
		{VARIABLE lever5 0}
		{VARIABLE chest1 0}
		{VARIABLE chest2 0}
		{VARIABLE chest3 0}

		[set_variable]
			name=scenario_number
			value=26
		[/set_variable]

		[objectives]
			side=1
			[objective]
				description= _ "Clean the fort"
				condition=win
			[/objective]
			[objective]
				description= _ "Death of Io"
				condition=lose
			[/objective]

			[gold_carryover]
				bonus=yes
				carryover_percentage=100
			[/gold_carryover]
		[/objectives]

		{LOI_RECALL_ALL 7 36}

	[/event]

	[side]
		type="Young Man"
		id=Io
		name= _ "Io"
		x=7
		y=36
		fog=no
		shroud=yes
		side=1
		canrecruit=yes
		profile=portraits/Io.png
		controller=human
		team_name=heroes
		user_team_name=_"Heroes"
		{GOLD -1 -25 -50}
		
	[/side]

	[side]
		no_leader=yes
		fog=yes
		shroud=yes
		side=2
		team_name=trolls
		user_team_name=_"Trolls"
		hidden=no
		[unit]
			ai_special=guardian
			name="Sär"
			type="Troll Hero"
			x=10
			y=25
		[/unit]
		[unit]
			ai_special=guardian
			name="Tsug Stah"
			type="Troll"
			x=4
			y=33
		[/unit]
		[unit]
			ai_special=guardian
			name="Uk"
			type="Troll"
			x=4
			y=28
		[/unit]
		[unit]
			ai_special=guardian
			name="Dügh Ükk"
			type="Troll"
			x=6
			y=31
		[/unit]
		[unit]
			ai_special=guardian
			name="Kräg"
			type="Troll"
			x=8
			y=30
		[/unit]
		[unit]
			ai_special=guardian
			name="Bakk Rag"
			type="Troll"
			x=6
			y=25
		[/unit]
		[unit]
			ai_special=guardian
			name="Kuur"
			type="Troll"
			x=6
			y=27
		[/unit]
		[unit]
			ai_special=guardian
			name="Tak"
			type="Troll"
			x=3
			y=26
		[/unit]
		[unit]
			ai_special=guardian
			name="Urf"
			type="Troll"
			x=2
			y=27
		[/unit]
		[unit]
			ai_special=guardian
			name="Krog"
			type="Troll"
			x=7
			y=32
		[/unit]
		[unit]
			ai_special=guardian
			name="Urf"
			type="Troll"
			x=5
			y=20
		[/unit]
		[unit]
			ai_special=guardian
			name="Buukk"
			type="Troll"
			x=6
			y=17
		[/unit]
		[unit]
			ai_special=guardian
			name="Ag Ukk"
			type="Troll"
			x=5
			y=12
		[/unit]
		[unit]
			ai_special=guardian
			name="Nath"
			type="Troll"
			x=6
			y=12
		[/unit]
		[unit]
			ai_special=guardian
			name="Ürg"
			type="Troll Hero"
			x=5
			y=13
		[/unit]
		[unit]
			ai_special=guardian
			name="Väkk"
			type="Troll Hero"
			x=4
			y=3
		[/unit]
		[unit]
			ai_special=guardian
			name="Ag"
			type="Troll Hero"
			x=4
			y=2
		[/unit]
		[unit]
			ai_special=guardian
			name="Bruk Tsüh"
			type="Troll Hero"
			x=6
			y=5
		[/unit]
		[unit]
			ai_special=guardian
			name="Brägh"
			type="Troll"
			x=7
			y=3
		[/unit]
		[unit]
			ai_special=guardian
			name="Thoh"
			type="Troll"
			x=7
			y=2
		[/unit]
		[unit]
			ai_special=guardian
			name="Huth"
			type="Troll"
			x=6
			y=3
		[/unit]
	[/side]

	[event]
		name=prestart

		#ifdef HARD
		[terrain]
			x=8,6
			y=36,36
			terrain=Uu
		[/terrain]
		#endif

		#ifdef EASY
		[terrain]
			x=5,7
			y=36,35
			terrain=Ce
		[/terrain]
		#endif
	[/event]

	[event]
		name=start

		[message]
			speaker=Io
			message="Thos ruins looks weird. They do not look like something trolls would build."
		[/message]
		[if]
			[have_unit]
				side=1
				id=Teumiuxe
			[/have_unit]
			[then]
				[message]
					speaker=Teumiuxe
					message="They are indeed no troll ruins. This is where the legionary patrols were living in the cave."
				[/message]
				[message]
					speaker=Teumiuxe
					message=""
				[/message]
				[message]
					speaker=Teumiuxe
					message="The fort is a bit north.
It would be good to flush them out of it. Legionaries would then have an easier time coming here to patrol again."
				[/message]
			[/then]
			[else]
				[message]
					speaker=Io
					message="There seems to be some kind of fort further north. I imagine the path goes through it."
				[/message]
			[/else]
		[/if]
	[/event]

	[event]
		name=enter_hex
		first_time_only=no
		[filter]
			x=5
			y=19
		[/filter]
		{VARIABLE plate1 1}
		{PLACE_IMAGE scenery/rune3-glow.png 5 19}
		[if]
			[variable]
				name=plate2
				equals=1
			[/variable]
			[then]
				[terrain]
					x=6
					y=16
					terrain=Ias
				[/terrain]
			[/then]
		[/if]
	[/event]

	[event]
		name=exit_hex
		first_time_only=no
		[filter]
			x=5
			y=19
		[/filter]
		{VARIABLE plate1 0}
		{REMOVE_IMAGE 5 19}
		[if]
			[variable]
				name=plate2
				equals=0
			[/variable]
			[variable]
				name=lever1
				equals=0
			[/variable]
			[then]
				[terrain]
					x=6
					y=16
					terrain=Xoa
				[/terrain]
			[/then]
		[/if]
	[/event]

	[event]
		name=enter_hex
		first_time_only=no
		[filter]
			x=7
			y=19
		[/filter]
		{VARIABLE plate2 1}
		{PLACE_IMAGE scenery/rune3-glow.png 7 19}
		[if]
			[variable]
				name=plate1
				equals=1
			[/variable]
			[then]
				[terrain]
					x=6
					y=16
					terrain=Ias
				[/terrain]
			[/then]
		[/if]
	[/event]

	[event]
		name=exit_hex
		first_time_only=no
		[filter]
			x=7
			y=19
		[/filter]
		{VARIABLE plate2 0}
		{REMOVE_IMAGE 7 19}
		[if]
			[variable]
				name=plate1
				equals=0
			[/variable]
			[variable]
				name=lever1
				equals=0
			[/variable]
			[then]
				[terrain]
					x=6
					y=16
					terrain=Xoa
				[/terrain]
			[/then]
		[/if]
	[/event]

	[event]
		name=moveto
		first_time_only=no
		[filter]
			side=1
			x=6
			y=15
		[/filter]
		[if]
			[variable]
				name=lever1
				equals=0
			[/variable]
			[then]
				[message]
					speaker=unit
					message="There is a lever on the wall. Should I pull it down?"
					[option]
						message="Yes, do it."
						[command]
							{VARIABLE lever1 1}
							[terrain]
								x=6
								y=16
								terrain=Ias
							[/terrain]
						[/command]
					[/option]
					[option]
						message="No, not now."
					[/option]
				[/message]
			[/then]
			[else]
				[message]
					speaker=unit
					message="There is a lever on the wall. Should I pull it up?"
					[option]
						message="Yes, do it."
						[command]
							{VARIABLE lever1 0}
							[if]
								[variable]
									name=plate1
									equals=1
								[/variable]
								[variable]
									name=plate2
									equals=1
								[/variable]
								[else]
									[terrain]
										x=6
										y=16
										terrain=Xoa
									[/terrain]
								[/else]
							[/if]
						[/command]
					[/option]
					[option]
						message="No, not now."
					[/option]
				[/message]
			[/else]
		[/if]
	[/event]

	[event]
		name=enter_hex
		first_time_only=no
		[filter]
			x=5
			y=14
		[/filter]
		{VARIABLE plate3 1}
		{PLACE_IMAGE scenery/rune3-glow.png 5 14}
		[if]
			[variable]
				name=plate4
				equals=1
			[/variable]
			[then]
				[terrain]
					x=4
					y=11
					terrain=Ias
				[/terrain]
			[/then]
		[/if]
	[/event]

	[event]
		name=exit_hex
		first_time_only=no
		[filter]
			x=5
			y=14
		[/filter]
		{VARIABLE plate3 0}
		{REMOVE_IMAGE 5 14}
		[if]
			[variable]
				name=plate4
				equals=0
			[/variable]
			[variable]
				name=lever2
				equals=0
			[/variable]
			[then]
				[terrain]
					x=4
					y=11
					terrain=Xoa
				[/terrain]
			[/then]
		[/if]
	[/event]

	[event]
		name=enter_hex
		first_time_only=no
		[filter]
			x=7
			y=14
		[/filter]
		{VARIABLE plate4 1}
		{PLACE_IMAGE scenery/rune3-glow.png 7 14}
		[if]
			[variable]
				name=plate3
				equals=1
			[/variable]
			[then]
				[terrain]
					x=4
					y=11
					terrain=Ias
				[/terrain]
			[/then]
		[/if]
	[/event]

	[event]
		name=exit_hex
		first_time_only=no
		[filter]
			x=7
			y=14
		[/filter]
		{VARIABLE plate4 0}
		{REMOVE_IMAGE 7 14}
		[if]
			[variable]
				name=plate3
				equals=0
			[/variable]
			[variable]
				name=lever2
				equals=0
			[/variable]
			[then]
				[terrain]
					x=4
					y=11
					terrain=Xoa
				[/terrain]
			[/then]
		[/if]
	[/event]

	[event]
		name=moveto
		first_time_only=no
		[filter]
			side=1
			x=3
			y=12
		[/filter]
		{VARIABLE plate5 1}
		{PLACE_IMAGE scenery/rune3-glow.png 3 12}
		[terrain]
			x=6
			y=11
			terrain=Ias
		[/terrain]
		[if]
			[variable]
				name=lever2
				equals=0
			[/variable]
			[then]
				[message]
					speaker=unit
					message="There is a lever on the wall. Should I pull it down?"
					[option]
						message="Yes, do it."
						[command]
							{VARIABLE lever2 1}
						[/command]
					[/option]
					[option]
						message="No, not now."
					[/option]
				[/message]
			[/then]
			[else]
				[message]
					speaker=unit
					message="There is a lever on the wall. Should I pull it up?"
					[option]
						message="Yes, do it."
						[command]
							{VARIABLE lever2 0}
							[if]
								[variable]
									name=plate3
									equals=1
								[/variable]
								[variable]
									name=plate4
									equals=1
								[/variable]
								[else]
									[terrain]
										x=4
										y=11
										terrain=Xoa
									[/terrain]
								[/else]
							[/if]
						[/command]
					[/option]
					[option]
						message="No, not now."
					[/option]
				[/message]
			[/else]
		[/if]
	[/event]

	[event]
		name=exit_hex
		first_time_only=no
		[filter]
			x=3
			y=12
		[/filter]
		{VARIABLE plate5 0}
		{REMOVE_IMAGE 3 12}
		[if]
			[variable]
				name=lever3
				equals=0
			[/variable]
			[then]
				[terrain]
					x=6
					y=11
					terrain=Xoa
				[/terrain]
			[/then]
		[/if]
	[/event]

	[event]
		name=moveto
		first_time_only=no
		[filter]
			side=1
			x=6
			y=10
		[/filter]
		[if]
			[variable]
				name=lever3
				equals=0
			[/variable]
			[then]
				[message]
					speaker=unit
					message="There is a lever on the wall. Should I pull it down?"
					[option]
						message="Yes, do it."
						[command]
							{VARIABLE lever3 1}
							[terrain]
								x=6
								y=11
								terrain=Ias
							[/terrain]
						[/command]
					[/option]
					[option]
						message="No, not now."
					[/option]
				[/message]
			[/then]
			[else]
				[message]
					speaker=unit
					message="There is a lever on the wall. Should I pull it up?"
					[option]
						message="Yes, do it."
						[command]
							{VARIABLE lever3 0}
							[if]
								[variable]
									name=plate5
									equals=1
								[/variable]
								[else]
									[terrain]
										x=6
										y=11
										terrain=Xoa
									[/terrain]
								[/else]
							[/if]
						[/command]
					[/option]
					[option]
						message="No, not now."
					[/option]
				[/message]
			[/else]
		[/if]
	[/event]

	[event]
		name=enter_hex
		first_time_only=no
		[filter]
			x=5
			y=9
		[/filter]
		{VARIABLE plate6 1}
		{PLACE_IMAGE scenery/rune3-glow.png 5 9}
		[if]
			[variable]
				name=plate7
				equals=1
			[/variable]
			[then]
				[terrain]
					x=8
					y=6
					terrain=Ias
				[/terrain]
			[/then]
		[/if]
	[/event]

	[event]
		name=exit_hex
		first_time_only=no
		[filter]
			x=5
			y=9
		[/filter]
		{VARIABLE plate6 0}
		{REMOVE_IMAGE 5 9}
		[if]
			[variable]
				name=plate7
				equals=0
			[/variable]
			[variable]
				name=lever2
				equals=0
			[/variable]
			[then]
				[terrain]
					x=8
					y=6
					terrain=Xoa
				[/terrain]
			[/then]
		[/if]
	[/event]

	[event]
		name=enter_hex
		first_time_only=no
		[filter]
			x=7
			y=9
		[/filter]
		{VARIABLE plate7 1}
		{PLACE_IMAGE scenery/rune3-glow.png 7 9}
		[if]
			[variable]
				name=plate6
				equals=1
			[/variable]
			[then]
				[terrain]
					x=8
					y=6
					terrain=Ias
				[/terrain]
			[/then]
		[/if]
	[/event]

	[event]
		name=exit_hex
		first_time_only=no
		[filter]
			x=7
			y=9
		[/filter]
		{VARIABLE plate7 0}
		{REMOVE_IMAGE 7 9}
		[if]
			[variable]
				name=plate6
				equals=0
			[/variable]
			[variable]
				name=lever4
				equals=0
			[/variable]
			[then]
				[terrain]
					x=8
					y=6
					terrain=Xoa
				[/terrain]
			[/then]
		[/if]
	[/event]

	[event]
		name=moveto
		first_time_only=no
		[filter]
			side=1
			x=9
			y=7
		[/filter]
		{VARIABLE plate8 1}
		{PLACE_IMAGE scenery/rune3-glow.png 9 7}
		[terrain]
			x=6
			y=6
			terrain=Ias
		[/terrain]
		[if]
			[variable]
				name=lever4
				equals=0
			[/variable]
			[then]
				[message]
					speaker=unit
					message="There is a lever on the wall. Should I pull it down?"
					[option]
						message="Yes, do it."
						[command]
							{VARIABLE lever4 1}
						[/command]
					[/option]
					[option]
						message="No, not now."
					[/option]
				[/message]
			[/then]
			[else]
				[message]
					speaker=unit
					message="There is a lever on the wall. Should I pull it up?"
					[option]
						message="Yes, do it."
						[command]
							{VARIABLE lever4 0}
							[if]
								[variable]
									name=plate6
									equals=1
								[/variable]
								[variable]
									name=plate7
									equals=1
								[/variable]
								[else]
									[terrain]
										x=8
										y=6
										terrain=Xoa
									[/terrain]
								[/else]
							[/if]
						[/command]
					[/option]
					[option]
						message="No, not now."
					[/option]
				[/message]
			[/else]
		[/if]
	[/event]

	[event]
		name=exit_hex
		first_time_only=no
		[filter]
			x=9
			y=7
		[/filter]
		{VARIABLE plate8 0}
		{REMOVE_IMAGE 9 7}
		[if]
			[variable]
				name=lever5
				equals=0
			[/variable]
			[then]
				[terrain]
					x=6
					y=6
					terrain=Xoa
				[/terrain]
			[/then]
		[/if]
	[/event]

	[event]
		name=moveto
		first_time_only=no
		[filter]
			side=1
			x=6
			y=5
		[/filter]
		[if]
			[variable]
				name=lever5
				equals=0
			[/variable]
			[then]
				[message]
					speaker=unit
					message="There is a lever on the wall. Should I pull it down?"
					[option]
						message="Yes, do it."
						[command]
							{VARIABLE lever5 1}
							[terrain]
								x=6
								y=6
								terrain=Ias
							[/terrain]
						[/command]
					[/option]
					[option]
						message="No, not now."
					[/option]
				[/message]
			[/then]
			[else]
				[message]
					speaker=unit
					message="There is a lever on the wall. Should I pull it up?"
					[option]
						message="Yes, do it."
						[command]
							{VARIABLE lever5 0}
							[if]
								[variable]
									name=plate8
									equals=1
								[/variable]
								[else]
									[terrain]
										x=6
										y=6
										terrain=Xoa
									[/terrain]
								[/else]
							[/if]
						[/command]
					[/option]
					[option]
						message="No, not now."
					[/option]
				[/message]
			[/else]
		[/if]
	[/event]

	[event]
		name=moveto
		[filter]
			side=1
			x=4
			y=3
		[/filter]
		[if]
			[variable]
				name=chest1
				equals=0
			[/variable]
			[then]
				[message]
					speaker=unit
					message="There is a chest. Should I open it?"
					[option]
						message="Yes, do it."
						[command]
							{VARIABLE chest1 1}
							{VARIABLE_OP result rand (empty, trapped, full)}
							[switch]
								variable=result
								[case]
									value=empty
									[message]
										speaker=unit
										message="It is empty."
									[/message]
								[/case]
								[case]
									value=trapped
									[harm_unit]
										[filter]
											x=4
											y=3
										[/filter]
										amount=10
										damage_type=fire
									[/harm_unit]
									[message]
										speaker=unit
										message= _ "Argh! The chest was trapped."
									[/message]
								[/case]
								[case]
									value=full
									{DEFAULT_DROP_ITEM 4 3 (bow, axe, staff)} 
									[message]
										speaker=unit
										message="This is something in the chest."
									[/message]
								[/case]
							[/switch]
						[/command]
					[/option]
					[option]
						message="No, it might be trapped."
					[/option]
				[/message]
			[/then]
		[/if]
	[/event]

	[event]
		name=moveto
		[filter]
			side=1
			x=8
			y=3
		[/filter]
		[if]
			[variable]
				name=chest2
				equals=0
			[/variable]
			[then]
				[message]
					speaker=unit
					message="There is a chest. Should I open it?"
					[option]
						message="Yes, do it."
						[command]
							{VARIABLE chest2 1}
							{VARIABLE_OP result rand (empty, trapped, full)}
							[switch]
								variable=result
								[case]
									value=empty
									[message]
										speaker=unit
										message="It is empty."
									[/message]
								[/case]
								[case]
									value=trapped
									[harm_unit]
										[filter]
											x=8
											y=3
										[/filter]
										amount=10
										damage_type=fire
									[/harm_unit]
									[message]
										speaker=unit
										message= _ "Argh! The chest was trapped."
									[/message]
								[/case]
								[case]
									value=full
									{DEFAULT_DROP_ITEM 8 3 (bow, axe, staff)} 
									[message]
										speaker=unit
										message="This is something in the chest."
									[/message]
								[/case]
							[/switch]
						[/command]
					[/option]
					[option]
						message="No, it might be trapped."
					[/option]
				[/message]
			[/then]
		[/if]
	[/event]

	[event]
		name=moveto
		[filter]
			side=1
			x=7
			y=5
		[/filter]
		[if]
			[variable]
				name=chest3
				equals=0
			[/variable]
			[then]
				[message]
					speaker=unit
					message="There is a chest. Should I open it?"
					[option]
						message="Yes, do it."
						[command]
							{VARIABLE chest3 1}
							{VARIABLE_OP result rand (empty, trapped, full)}
							[switch]
								variable=result
								[case]
									value=empty
									[message]
										speaker=unit
										message="It is empty."
									[/message]
								[/case]
								[case]
									value=trapped
									[harm_unit]
										[filter]
											x=7
											y=5
										[/filter]
										amount=10
										damage_type=fire
									[/harm_unit]
									[message]
										speaker=unit
										message= _ "Argh! The chest was trapped."
									[/message]
								[/case]
								[case]
									value=full
									{DEFAULT_DROP_ITEM 7 5 (bow, axe, staff)} 
									[message]
										speaker=unit
										message="This is something in the chest."
									[/message]
								[/case]
							[/switch]
						[/command]
					[/option]
					[option]
						message="No, not now."
					[/option]
				[/message]
			[/then]
		[/if]
	[/event]

	[event]
		name=side 1 turn refresh
		[if]
			[not]
				[have_unit]
					side=2
				[/have_unit]
			[/not]
			[variable]
				name=chest1
				equals=1
			[/variable]
			[variable]
				name=chest2
				equals=1
			[/variable]
			[variable]
				name=chest3
				equals=1
			[/variable]
			[have_unit]
				side=1
				id=Teumiuxe
			[/have_unit]
			[then]
				[message]
					speaker=Teumiuxe
					message="I think there are no more trolls in there. We can go back to the crossing and take the other path to the exit."
				[/message]
				[endlevel]
					result=victory
					bonus=yes
					next_scenario=27
					{NEW_GOLD_CARRYOVER 100}
				[/endlevel]
			[/then]
		[/if]
	[/event]

	[event]
		name=time over
		[if]
			[have_unit]
				side=2
			[/have_unit]
			[then]
				[if]
					[have_unit]
						side=1
						id=Teumiuxe
					[/have_unit]
					[then]
						[message]
							speaker=Io
							message="We already spent too much time here. We do not have enough time to clean the whole fort.
							Let's go."
						[/message]
						[endlevel]
							result=victory
							bonus=no
							next_scenario=27
							{NEW_GOLD_CARRYOVER 100}
						[/endlevel]
					[/then]
					[else]
						[message]
							speaker=Io
							message="We already spent too much time here. I don't think the exit is this way.
							Let's go back to the crossing and take the other road."
						[/message]
						[endlevel]
							result=victory
							bonus=no
							next_scenario=27
							{NEW_GOLD_CARRYOVER 100}
						[/endlevel]
					[/else]
				[/if]
			[/then]
			[else]
				[if]
					[have_unit]
						side=1
						id=Teumiuxe
					[/have_unit]
					[then]
						[message]
							speaker=Io
							message="I think there are no more trolls in there. 
							Let's go back to the crossing and take the other path to the exit."
						[/message]
						[endlevel]
							result=victory
							bonus=yes
							next_scenario=27
							{NEW_GOLD_CARRYOVER 100}
						[/endlevel]
					[/then]
					[else]
						[message]
							speaker=Io
							message="We already spent too much time here. I don't think the exit is this way.
							Let's go back to the crossing and take the other road."
						[/message]
						[endlevel]
							result=victory
							bonus=yes
							next_scenario=27
							{NEW_GOLD_CARRYOVER 100}
						[/endlevel]
					[/else]
				[/if]
			[/else]
		[/if]
	[/event]

	{DROPS 20 0 (bow,axe,staff) yes 2}

	{DISABLE_NEGATIVE_INCOME 1}

	{GLOBAL_EVENTS}
[/scenario]

